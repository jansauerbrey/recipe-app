angular.module('app',['app.auth','app.recipes','app.schedules','app.shopitems','app.units','app.ingredients','app.tags','app.dishtypes','app.admin','app.alert','ui.router','ngAnimate','ngResource','ngStorage','ui.bootstrap','ngTagsInput','angular.filter','ngAside','angular-spinkit','gm.datepickerMultiSelect','720kb.socialshare','as.sortable']).constant('BASE_URI','https://www.rezept-planer.de/').factory('navigationMenu',['$state',function(e){const t=[],i=e.get();return angular.forEach(i,function(e){e.data&&e.data.name&&t.push({path:e.url,name:e.name,label:e.data.name,icon:e.data.icon?e.data.icon:null,panelright:e.data.panelright?e.data.panelright:!1,requiresLogin:e.data.requiresLogin?e.data.requiresLogin:!1,requiredPermissions:e.data.requiredPermissions?e.data.requiredPermissions.join():void 0});}),{states:t};}]).factory('navigationTitle',['$state',function(e){const t={title:''};return{getObject:function(){return t;}};}]).factory('subdomain',['$location',function(e){const t=e.host();return t.indexOf('.')<0?null:t.split('.')[0];}]).factory('httpPostFactory',['$http','BASE_URI',function(e,t){return function(i,r,a){e({url:t+i,method:'POST',data:r,headers:{'Content-Type':void 0}}).success(function(e){a(e);});};}]).factory('isCordova',function(){const e=-1===document.URL.indexOf('http://')&&-1===document.URL.indexOf('https://');return!!e;}).controller('NavbarController',['$scope','navigationTitle','subdomain',function(e,t,i){e.navObject=t.getObject(),e.showBeta='beta'==i;}]).controller('NavSidebarController',['$scope','$uibModalInstance',function(e,t){e.cancel=function(){t.dismiss('cancel');};}]).controller('StartpageController',['$scope',function(e){e.openLink=function(e){window.open(e);};}]).directive('navsidebar',['$aside','UserService',function(e,t){return{restrict:'E',replace:!0,templateUrl:'partials/navigation.sidebar.button.tpl.html',controller:['$scope','$state',function(t,i){t.showBackNav=function(){return i.includes('user.recipes')&&i.$current.path.length>2;},t.onClick=function(){if(this.showBackNav()){to=i.$current;do to=to.parent;while(to['abstract']);return i.transitionTo(to,{},{inherit:!0,relative:i.$current});}e.open({templateUrl:'partials/navigation.sidebar.tpl.html',controller:'NavSidebarController',placement:'left',size:'lg'});};}]};}]).directive('access',['$rootScope','UserService',function(e,t){return{restrict:'A',link:function(i,r,a){var s=function(){r.removeClass('hidden');},n=function(){r.addClass('hidden');},o=function(e){let i;e&&s(),i=t.authorize(void 0,c),0===i?s():n();},c=a.access.split(',');c.length>0&&o(!0),e.$on('$stateChangeSuccess',function(){c.length>0&&o(!0);});}};}]).directive('ngReallyClick',['$uibModal',function(e){return{restrict:'A',scope:{ngReallyClick:'&'},link:function(t,i,r){i.bind('click',function(){if(t.$parent.schedule&&t.$parent.schedule.recipe&&t.$parent.schedule.recipe.name)var i='Are you sure to delete the recipe '+t.$parent.schedule.recipe.name+' from schedule?';else if(t.$parent.recipe&&t.$parent.recipe.name)var i='Are you sure to delete the recipe '+t.$parent.recipe.name+'?';else var i=r.ngReallyMessage||'Are you sure?';const a=e.open({animation:!0,templateUrl:'partials/ngreally.tpl.html',controller:['$scope','$uibModalInstance','message',function(e,t,i){e.message=i,e.ok=function(){t.close();},e.cancel=function(){t.dismiss('cancel');};}],size:'xs',resolve:{message:function(){return i;}}});a.result.then(function(){t.ngReallyClick();});});}};}]).directive('ngImageUpload',['httpPostFactory',function(e){return{restrict:'A',scope:!0,link:function(t,i,r){i.bind('change',function(){const r=new FormData;r.append('file',i[0].files[0]),e('api/upload',r,function(e){console.log(e),t.recipe.imagePath=e;});});}};}]).directive('cameraButton',['httpPostFactory',function(e){return{restrict:'A',scope:!0,link:function(t,i,r){i.bind('click',function(){navigator.camera.getPicture(function(i){window.resolveLocalFileSystemURL(i,function(i){i.file(function(i){const r=new FileReader;r.onloadend=function(r){const a=new Blob([r.target.result],{type:i.type}),s=new FormData;s.append('file',a,'file.jpg'),e('api/upload',s,function(e){t.recipe.imagePath=e;});},r.readAsArrayBuffer(i);},function(e){});},function(e){});},function(e){},{quality:50,destinationType:Camera.DestinationType.FILE_URI});});}};}]).directive('stateLoadingIndicator',['$rootScope',function(e){return{restrict:'E',template:'<div ng-show=\'isStateLoading\' class=\'loading-indicator overlay\'><div class=\'loading-indicator-body\'><div class=\'spinner\'><double-bounce-spinner></double-bounce-spinner></div></div></div>',replace:!0,link:function(t,i,r){t.isStateLoading=!1,e.$on('$stateChangeStart',function(){t.isStateLoading=!0;}),e.$on('$stateChangeSuccess',function(){t.isStateLoading=!1;});}};}]).filter('timeFilter',function(){const e={ss:angular.identity,mm:function(e){return 60*e;},hh:function(e){return 3600*e;}};return function(t,i){let r=e[i||'ss'](t),a=Math.floor(r/3600),s=Math.floor(r%3600/60);return a=a>0?a:'',format=''==a?'mm min':'hhh mmm',format.replace(/hh/,a).replace(/mm/,s);};}).config(['$stateProvider','$urlRouterProvider',function(e,t){t.otherwise('/'),e.state('anon',{'abstract':!0,views:{root:{template:'<ui-view />'}},data:{requiresLogin:!1,requiredPermissions:['NoUser']}}).state('anon.startpage',{url:'/',templateUrl:'partials/startpage.tpl.html',controller:'StartpageController',data:{title:'rezept-planer.de'}}).state('anon.user',{url:'/user','abstract':!0,template:'<ui-view />'}).state('user',{'abstract':!0,views:{root:{template:'<div ui-view="main"></div>'}},data:{requiresLogin:!0,requiredPermissions:['User']}}).state('impressum',{url:'/impressum',views:{root:{templateUrl:'partials/impressum.tpl.html'}},data:{title:'Impressum'}}).state('accessdenied',{url:'/access/denied',views:{root:{templateUrl:'partials/access.denied.tpl.html'}}}).state('user.home',{url:'/home',views:{main:{templateUrl:'partials/home.tpl.html'}},data:{title:'Home'}});}]).run(['$rootScope','$state','$stateParams','$http','UserService','navigationTitle','BASE_URI',function(e,t,i,r,a,s,n){e.$state=t,e.$stateParams=i,e.print=function(e){window.print();},e.$on('$stateChangeStart',function(i,o,c,l,u){e.previousState=l?l:{},e.previousState.name=l.name?l.name:'user.home',e.previousStateParams=u?u:{};const d=a.isAuthenticated();if(d===!0&&(r.get(n+'api/user/check'),'anon.startpage'==o.name&&(i.preventDefault(),t.go('user.home'))),o.data&&o.data.title){const p=s.getObject();p.title=o.data.title;}}),e.$on('$stateChangeSuccess',function(){document.body.scrollTop=document.documentElement.scrollTop=0;});}]),angular.module('app.admin',['ui.router']).factory('Users',['$resource','BASE_URI',function(e,t){return e(t+'api/admin/user/:id',null,{update:{method:'PUT'}});}]).controller('AdminUserCtrl',['$scope','$state','users','Users',function(e,t,i,r){e.users=i,e.remove=function(t){r.remove({id:t._id},function(){e.users.splice(e.users.indexOf(t),1);});},e.activate=function(t){e.users[e.users.indexOf(t)].is_activated=!0,r.update({id:t._id},{is_activated:!0},function(){});},e.makeAdmin=function(t){e.users[e.users.indexOf(t)].is_admin=!0,r.update({id:t._id},{is_admin:!0},function(){});},e.removeAdmin=function(t){e.users[e.users.indexOf(t)].is_admin=!1,r.update({id:t._id},{is_admin:!1},function(){});};}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('admin',{'abstract':!0,views:{root:{template:'<ui-view />'}},data:{requiresLogin:!0,requiredPermissions:['Admin'],title:'Admin'}}).state('admin.user',{url:'/admin/user',templateUrl:'partials/admin.user.tpl.html',controller:'AdminUserCtrl',resolve:{users:['Users',function(e){return e.query().$promise;}]},data:{title:'Users'}});}]),angular.module('app.auth',['ui.router']).factory('User',['$resource','BASE_URI',function(e,t){return e(t+'api/user/info/:id',null,{update:{method:'PUT'}});}]).factory('UserService',['$localStorage','$injector',function(e,t){const i={currentUser:{},currentUserCopy:{},languageOptions:[{id:'en',name:'English'},{id:'de',name:'Deutsch'},{id:'fi',name:'Suomi'}],weekdayOptions:[{id:0,name:'Sunday'},{id:1,name:'Monday'},{id:2,name:'Tueasday'},{id:3,name:'Wednesday'},{id:4,name:'Thursday'},{id:5,name:'Friday'},{id:6,name:'Saturday'}]},r=function(t){i.currentUser=t,i.currentUserCopy=angular.copy(i.currentUser),e.user=t;},a=function(){return i.currentUser;},s=function(){delete i.currentUser,delete i.currentUserCopy,delete e.user;},n=function(){return angular.isObject(i.currentUser)&&'_id'in i.currentUser;},o=function(){return i.currentUser&&i.currentUser.token?i.currentUser.token:void 0;},c=function(e,t,i){let r,s,o=0,c=a(),l=n(),u=[],d=!0;if(i=i||0,e===!0&&void 0===c)o=1;else if(e!==!0||l!==!0||void 0!==t&&0!==t.length){if(t){for(l===!1&&(c={permissions:['NoUser']}),u=[],angular.forEach(c.permissions,function(e){u.push(e.toLowerCase());}),s=0;s<t.length;s+=1)if(r=t[s].toLowerCase(),1===i){if(d=d&&u.indexOf(r)>-1,d===!1)break;}else if(0===i&&(d=u.indexOf(r)>-1))break;o=d?0:2;}}else o=0;return o;},l=function(t){void 0!==i.currentUser&&(i.currentUser.favoriteRecipes=t,i.currentUserCopy=angular.copy(i.currentUser),e.user.favoriteRecipes=t);},u=function(e){if(void 0!==i.currentUser){const r=t.get('User');r.update({id:i.currentUser._id},{fullname:i.currentUserCopy.fullname,settings:i.currentUserCopy.settings},function(t){for(const r in t)i.currentUser[r]=t[r];i.currentUserCopy=angular.copy(i.currentUser),e();});}};return e.user&&r(e.user),{data:i,createUser:r,getCurrentLoginUser:a,deleteCurrentUser:s,isAuthenticated:n,getToken:o,authorize:c,updateFavoriteRecipes:l,updateUserSettings:u};}]).factory('AuthenticationService',['$http','$localStorage','$state','$stateParams','$rootScope','UserService','BASE_URI','AlertService',function(e,t,i,r,a,s,n,o){const c=function(t,r,a){void 0!==t&&void 0!==r?e.post(n+'api/user/login',{username:t,password:r,autologin:a}).success(function(e){e.permissions=['User'],e.is_admin&&e.permissions.push('Admin'),s.createUser(e),i.go('user.home');}).error(function(e){o.add('info','If you have registered succesfully, please check your email to confirm your email address.');}):o.add('danger',' Please fill out username and password.');},l=function(){e.get(n+'api/user/logout').success(function(){s.deleteCurrentUser(),o.add('success','You hav been successfully loged out.'),i.go('anon.startpage');}).error(function(){o.add('danger','Network connection error.'),i.go(a.previousState.name,a.previousStateParams);});},u=function(t){e.post(n+'api/user/register',t).success(function(){o.add('success',' Please check your email to confirm your address and to activate your account.'),i.go('anon.user.login');}).error(function(e){o.add('danger','Network or certificate error.');});},d=function(){r&&r.token&&e.get(n+'api/user/confirm/'+r.token).success(function(e){o.add('success','Email has been successfully confirmed. You are now able to login with your credentials.'),i.go('anon.user.login');}).error(function(e){o.add('danger','Network or certificate error.');});},p=function(t){return void 0!==t?e.post(n+'api/user/forgot',{username:t}).success(function(e){o.add('success','Password renewal process has been started. Please check your email for further instructions.'),i.go('anon.user.login');}):void o.add('danger','Please enter username.');},m=function(t,a){return void 0!==t&&t===a?e.put(n+'api/user/reset/'+r.token,{password:t,passwordConfirmation:a}).success(function(e){o.add('success','Password has been reset successfully. Please use the new password to login.'),i.go('anon.user.login');}):void o.add('danger','Please enter the same password into password and password confirmation.');};return{logIn:c,logOut:l,register:u,confirmEmail:d,requestNewPassword:p,resetPassword:m};}]).factory('TokenInterceptor',['$q','UserService','$injector','AlertService',function(e,t,i,r){return{request:function(e){return e.headers=e.headers||{},t.isAuthenticated()===!0&&(e.headers.Authorization='AUTH '+t.getToken()),e;},requestError:function(t){return e.reject(t);},response:function(t){return null!=t&&200==t.status,t||e.when(t);},responseError:function(a){if(null!=a&&401===a.status){t.deleteCurrentUser(),r.add('danger','Access denied!');const s=i.get('$state');s.go('anon.startpage');}return e.reject(a);}};}]).controller('UserAuthenticationController',['$scope','Users','AuthenticationService','UserService',function(e,t,i,r){e.languageOptions=r.data.languageOptions,e.weekdayOptions=r.data.weekdayOptions,e.user=new t,e.logIn=function(){i.logIn(e.login.username,e.login.password,e.login.autologin);},e.register=function(){i.register(e.user);};}]).controller('UserConfirmEmailController',['AuthenticationService',function(e){e.confirmEmail();}]).controller('UserLogoutController',['AuthenticationService',function(e){e.logOut();}]).controller('UserPasswordRenewalController',['$scope','AuthenticationService',function(e,t){e.requestNewPassword=function(e){t.requestNewPassword();},e.resetPassword=function(e,i){t.resetPassword();};}]).controller('UserSettingsController',['$scope','$state','UserService','AlertService',function(e,t,i,r){e.languageOptions=i.data.languageOptions,e.weekdayOptions=i.data.weekdayOptions,i.data.currentUserCopy=angular.copy(i.data.currentUser),e.user=i.data.currentUserCopy,e.updateUserSettings=function(){i.updateUserSettings(function(){r.add('success','Settings successfully updated.'),t.go('user.settings');});};}]).config(['$httpProvider',function(e){e.interceptors.push('TokenInterceptor');}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('anon.user.register',{url:'/register',templateUrl:'partials/user.register.tpl.html',controller:'UserAuthenticationController',data:{title:'Register'}}).state('anon.user.confirm',{url:'/confirm/:token',controller:'UserConfirmEmailController',data:{title:'Confirm Email'}}).state('anon.user.login',{url:'/login',templateUrl:'partials/user.login.tpl.html',controller:'UserAuthenticationController',data:{title:'Login'}}).state('user.logout',{url:'/user/logout',views:{main:{template:'<div class="loading-indicator overlay"><div class="loading-indicator-body"><div class="spinner"><double-bounce-spinner></double-bounce-spinner></div></div></div>',controller:'UserLogoutController'}},data:{title:'Logout'}}).state('anon.forgot',{url:'/user/forgot',templateUrl:'partials/user.forgot.tpl.html',controller:'UserPasswordRenewalController',data:{title:'Forgot password'}}).state('anon.reset',{url:'/user/reset/:token',templateUrl:'partials/user.reset.tpl.html',controller:'UserPasswordRenewalController',data:{title:'Reset password'}}).state('user.settings',{url:'/user/settings',views:{main:{templateUrl:'partials/user.settings.view.tpl.html',controller:'UserSettingsController'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.settings.edit"><i class="glyphicon glyphicon-pencil"></i></button>'}},data:{title:'User settings'}}).state('user.settings.edit',{url:'/edit',views:{'main@user':{templateUrl:'partials/user.settings.edit.tpl.html',controller:'UserSettingsController'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="updateUserSettings()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:'UserSettingsController'}}});}]),angular.module('app.dishtypes',['ui.router']).factory('DishTypes',['$resource','BASE_URI',function(e,t){return e(t+'api/dishtypes/:id',null,{update:{method:'PUT'}});}]).controller('DishTypesController',['$scope','dishtypes',function(e,t){e.dishtypes=t;}]).controller('DishTypeDetailCtrl',['$scope','$stateParams','dishtype','DishTypes','$state',function(e,t,i,r,a){e.dishtype=i,e.update=function(){r.update({id:e.dishtype._id},e.dishtype,function(){a.go('admin.dishtypes.list');});},e.remove=function(){r.remove({id:e.dishtype._id},function(){a.go('admin.dishtypes.list');});},e.save=function(){if(e.newdishtype&&!(e.newdishtype.length<1)){const t=new r({name:{en:e.newdishtype.name.en,de:e.newdishtype.name.de,fi:e.newdishtype.name.fi},order:e.newdishtype.order,imagePath:e.newdishtype.imagePath});t.$save(function(){a.go('admin.dishtypes.list');});}};}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('admin.dishtypes',{'abstract':!0,url:'/dishtypes',template:'<ui-view />',data:{title:'Dish types'}}).state('admin.dishtypes.list',{url:'/list',templateUrl:'partials/dishtypes.tpl.html',controller:'DishTypesController',resolve:{dishtypes:['DishTypes',function(e){return e.query().$promise;}]},data:{name:'Dish types',icon:'glyphicon glyphicon-grain'}}).state('admin.dishtypes.edit',{url:'/edit/:id',templateUrl:'partials/dishtypes.details.tpl.html',controller:'DishTypeDetailCtrl',resolve:{dishtype:['DishTypes','$stateParams',function(e,t){const i=e.get({id:t.id},function(e){return e;}).$promise;return i;}]}}).state('admin.dishtypes.add',{url:'/add',templateUrl:'partials/dishtypes.add.tpl.html',controller:'DishTypeDetailCtrl',resolve:{dishtype:['DishTypes',function(e){const t=new e;return t;}]}});}]),angular.module('app.ingredients',['ui.router']).factory('Ingredients',['$resource','BASE_URI',function(e,t){return e(t+'api/ingredients/:id',null,{update:{method:'PUT'}});}]).factory('TAIngredients',['$resource','BASE_URI',function(e,t){return e(t+'api/typeahead/ingredients/',null,{search:{method:'GET',isArray:!0}});}]).factory('Categories',['$resource','BASE_URI',function(e,t){return e(t+'api/categories/:id',null,{update:{method:'PUT'}});}]).controller('IngredientsController',['$scope','ingredients',function(e,t){e.ingredients=t;}]).controller('IngredientDetailCtrl',['$scope','$stateParams','ingredient','Ingredients','categories','$state',function(e,t,i,r,a,s){e.categories=a,e.selectedcategory={},e.ingredient=i,e.selectedcategory.category=i.category,e.selectedcategory.subcategory=i.subcategory,e.selectedcategory.subsubcategory=i.subsubcategory,e.selectedcategory.rewe_cat_id=i.rewe_cat_id,e.update=function(){e.ingredient.category=e.selectedcategory.category,e.ingredient.subcategory=e.selectedcategory.subcategory,e.ingredient.subsubcategory=e.selectedcategory.subsubcategory,e.ingredient.rewe_cat_id=e.selectedcategory.rewe_cat_id,r.update({id:e.ingredient._id},e.ingredient,function(){s.go('admin.ingredients.list');});},e.remove=function(){r.remove({id:e.ingredient._id},function(){s.go('admin.ingredients.list');});},e.save=function(){if(e.newingredient&&!(e.newingredient.length<1)){e.newingredient.category=e.selectedcategory.category,e.newingredient.subcategory=e.selectedcategory.subcategory,e.newingredient.subsubcategory=e.selectedcategory.subsubcategory,e.newingredient.rewe_cat_id=e.selectedcategory.rewe_cat_id;const t=new r(e.newingredient);t.$save(function(){s.go('admin.ingredients.list');});}};}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('admin.ingredients',{'abstract':!0,url:'/ingredients',template:'<ui-view />',data:{title:'Ingredients'}}).state('admin.ingredients.list',{url:'/list',templateUrl:'partials/ingredients.tpl.html',controller:'IngredientsController',resolve:{ingredients:['Ingredients',function(e){return e.query().$promise;}]},data:{name:'Ingredients',icon:'glyphicon glyphicon-apple'}}).state('admin.ingredients.edit',{url:'/edit/:id',templateUrl:'partials/ingredients.details.tpl.html',controller:'IngredientDetailCtrl',resolve:{ingredient:['Ingredients','$stateParams',function(e,t){const i=e.get({id:t.id},function(e){return e;}).$promise;return i;}],categories:['Categories',function(e){return e.query().$promise;}]}}).state('admin.ingredients.add',{url:'/add',templateUrl:'partials/ingredients.add.tpl.html',controller:'IngredientDetailCtrl',resolve:{ingredient:['Ingredients',function(e){const t=new e;return t;}],categories:['Categories',function(e){return e.query().$promise;}]}});}]),angular.module('app.recipes',['ui.router','modalstate','app.alert']).factory('Recipes',['$resource','BASE_URI',function(e,t){return e(t+'api/recipes/:id',null,{update:{method:'PUT'}});}]).factory('TARecipes',['$resource','BASE_URI',function(e,t){return e(t+'api/typeahead/recipes/',null,{search:{method:'GET',isArray:!0}});}]).factory('TagsSelected',['$resource','BASE_URI',function(e,t){return e(t+'api/tags/selected/:id',null,{update:{method:'PUT'}});}]).factory('TATags',['$resource','BASE_URI',function(e,t){return e(t+'api/typeahead/tags/',null,{search:{method:'GET',isArray:!0}});}]).factory('Favorites',['$resource','BASE_URI',function(e,t){return e(t+'api/user/favorites/:id',null,{update:{method:'PUT'}});}]).factory('RecipeService',['$rootScope','$stateParams','$uibModal','AlertService','Recipes','$state','Favorites','UserService','Tags',function(e,t,r,a,s,n,o,c,l){const u={recipe:{},recipeOrig:{},factorAvailable:!1,factor:0,userExists:!1,allowEdit:!1,submitted:!1,validForm:!1},d=function(e,t){u.recipe=e,u.recipeOrig=angular.copy(u.recipe),u.factorAvailable=t>0,u.factor=u.factorAvailable?t:u.recipe['yield'];const i=c.getCurrentLoginUser();u.recipe.author&&i&&i._id==u.recipe.author._id||i&&i.is_admin===!0?(u.userExists=!0,u.allowEdit=!0):i&&(u.userExists=!0);},p=function(){if(!u.validForm)return a.add('danger','Please complete all required fields before saving.'),u.submitted=!0,void e.$broadcast('submittedValueChanged');if(u.recipe&&!(u.recipe.length<1)){for(u.recipe.ingredients=u.recipe.ingredients.filter(function(e){return''!=e;}),i=0;i<u.recipe.tags.length;i++)if(!u.recipe.tags[i]._id){const t=new l(u.recipe.tags[i]);t.$save(),u.recipe.tags[i]=t._id;}for(i=0;i<u.recipe.ingredients.length;i++)u.recipe.ingredients[i].ingredient&&u.recipe.ingredients[i].ingredient._id||u.recipe.ingredients.splice(i,1);delete u.recipe._id,u.recipe.$save(function(e){n.go('user.recipes.details.view',{id:e._id});});}},m=function(){if(!u.validForm)return a.add('danger','Please complete all required fields before saving.'),u.submitted=!0,void e.$broadcast('submittedValueChanged');for(i=0;i<u.recipe.tags.length;i++)if(!u.recipe.tags[i]._id){const t=new l(u.recipe.tags[i]);t.$save(),u.recipe.tags[i]=t._id;}for(u.recipe.ingredients=u.recipe.ingredients.filter(function(e){return''!=e;}),i=0;i<u.recipe.ingredients.length;i++)u.recipe.ingredients[i].ingredient&&u.recipe.ingredients[i].ingredient._id||u.recipe.ingredients.splice(i,1);s.update({id:u.recipe._id},u.recipe,function(t){d(t),n.go(e.previousState.name,e.previousStateParams);});},f=function(){s.remove({id:u.recipe._id},function(){'user.recipes.details.edit'===e.previousState.name?n.go('user.recipes.dishtypes'):n.go(e.previousState.name,e.previousStateParams);});},g=function(){u.recipe=angular.copy(u.recipeOrig),n.go(e.previousState.name,e.previousStateParams);},h=function(){const e=u;o.update({id:u.recipe._id},{method:'add'},function(t){c.updateFavoriteRecipes(t.favoriteRecipes),e.recipe.fav_recipe=!0;});},v=function(){const e=u;o.update({id:u.recipe._id},{method:'delete'},function(t){c.updateFavoriteRecipes(t.favoriteRecipes),e.recipe.fav_recipe=!1;});};return{data:u,setRecipe:d,setFavorite:h,unsetFavorite:v,create:p,update:m,remove:f,cancel:g};}]).factory('RecipeListService',['$rootScope','$stateParams','$uibModal','AlertService','Recipes','$state','Favorites','UserService','Tags',function(e,t,i,r,a,s,n,o,c){const l={recipes:[]},u=function(e,t){let i;for(i=0;i<e.length;i++)if(angular.equals(e[i],t))return i;return!1;},d=function(e){l.recipes=e;},p=function(){let e=l,i=new Date;i=t.new_recipe?i.setDate(i.getDate()-14):new Date(2015,0,0);const r={author:t.author,updated_at:i,dishType:t.dishType,_id:t.fav_recipe};a.query(r,function(t){e.recipes=t;});},m=function(e){const t=l,i=u(l.recipes,e);n.update({id:e._id},{method:'add'},function(e){o.updateFavoriteRecipes(e.favoriteRecipes),t.recipes[i].fav_recipe=!0;});},f=function(e){const t=l,i=u(l.recipes,e);n.update({id:e._id},{method:'delete'},function(e){o.updateFavoriteRecipes(e.favoriteRecipes),t.recipes[i].fav_recipe=!1;});};return{getObject:function(){return l;},setRecipes:d,queryRecipes:p,setFavorite:m,unsetFavorite:f};}]).controller('RecipeDishTypeController',['$scope','UserService','recipeCount',function(e,t,i){e.user=t.getCurrentLoginUser(),e.recipeCount=i.data;}]).controller('RecipeListController',['$scope','$stateParams','$uibModal','RecipeListService','tags','user','Favorites','UserService',function(e,t,r,a,s,n,o,c){e.user=n,e.data=a.getObject(),e.tags=s,e.search={},e.tagfilter={},e.hideAdvSearch=!0,e.disableAndClearAuthor=function(){void 0!==e.search.author._id&&(e.search.author.fullname=void 0);},e.filterByTags=function(t){let r=!0;return angular.forEach(e.tagfilter,function(e,a){if(e===!0){let s=!1;for(i=0;i<t.tags.length;i++)if(a===t.tags[i].text){s=!0;break;}r=r&&s;}}),r;},e.switchFavorite=function(e){e.fav_recipe?a.unsetFavorite(e):a.setFavorite(e);},e.share=function(e){r.open({animation:!0,templateUrl:'partials/recipes.share.tpl.html',controller:'ModalShareControllerRecipes',size:'xs',resolve:{recipe:function(){return e;}}});};}]).controller('RecipeDetailCtrl',['$rootScope','$scope','$stateParams','$uibModal','Tags','units','dishtypes','TAIngredients','TATags','isCordova','RecipeService','navigationTitle',function(e,t,i,r,a,s,n,o,c,l,u,d){t.isCordova=l,u.data.submitted=!1,t.submitted=u.data.submitted,t.recipe=u.data.recipe,t.factorAvailable=u.data.factorAvailable,t.factor=u.data.factor,t.allowEdit=u.data.allowEdit,t.userExists=u.data.userExists;const p=d.getObject();p.title=t.recipe.name,t.favorite=function(){u.setFavorite();},t.unfavorite=function(){u.unsetFavorite();},t.save=function(){u.create();},t.update=function(){u.update();},t.remove=function(){u.remove();},t.cancel=function(){u.cancel();},t.$on('submittedValueChanged',function(){t.submitted=u.data.submitted;}),t.clearImage=function(){t.recipe.imagePath='no_image.png';},t.share=function(){r.open({animation:!0,templateUrl:'partials/recipes.share.tpl.html',controller:'ModalShareControllerRecipes',size:'xs',resolve:{recipe:function(){return t.recipe;}}});},t.units=s,t.dishtypes=n,t.onTypeaheadSelect=function(e,i,r){t.recipe.ingredients.filter(function(e){return''==e.ingredient;}).length||t.recipe.ingredients.push({qty:'',unit:'',ingredient:''});},t.GetIngredients=function(e){return o.search({search:e,language:t.recipe.language}).$promise.then(function(e){return e;});},t.addTag=function(e){if(!e._id){const i=new a(e);i.$save(function(e){const i=t.recipe.tags.length;t.recipe.tags[i-1]=e;});}},t.loadTags=function(e){return c.search({search:e}).$promise.then(function(e){return e;});},t.$watch('recipeForm.$valid',function(e){u.data.validForm=e;});}]).controller('ModalShareControllerRecipes',['$scope','$uibModalInstance','$filter','recipe',function(e,t,r,a){e.recipe=a;const s=[];for(i=0;i<a.tags.length;i++)s.push(a.tags[i].text);e.hashtags=s.join(', '),e.cancel=function(){t.dismiss('cancel');};}]).controller('RecipeDetailActionsCtrl',['$rootScope','$scope','$uibModal','RecipeService',function(e,t,i,r){t.submitted=r.data.submitted,t.recipe=r.data.recipe,t.allowEdit=r.data.allowEdit,t.userExists=r.data.userExists,t.favorite=function(){r.setFavorite();},t.unfavorite=function(){r.unsetFavorite();},t.save=function(){r.create();},t.update=function(){r.update();},t.remove=function(){r.remove();},t.cancel=function(){r.cancel();},t.share=function(){i.open({animation:!0,templateUrl:'partials/recipes.share.tpl.html',controller:'ModalShareControllerRecipes',size:'xs',resolve:{recipe:function(){return t.recipe;}}});};}]).controller('RecipeDetailActionSidebarController',['$rootScope','$scope','$uibModal','RecipeService','$uibModalInstance','isCordova','AlertService',function(e,t,i,r,a,s,n){t.isCordova=s,t.submitted=r.data.submitted,t.recipe=r.data.recipe,t.allowEdit=r.data.allowEdit,t.userExists=r.data.userExists,t.isCordova===!0?t.printingAvailable=cordova.plugins.printer.isAvailable(function(e){return e;}):t.printingAvailable=!1,t.favorite=function(){r.setFavorite();},t.unfavorite=function(){r.unsetFavorite();},t.save=function(){r.data.submitted=!0,r.create();},t.update=function(){r.data.submitted=!0,r.update();},t.remove=function(){r.remove();},t.cancel=function(){r.cancel();},t.share=function(){i.open({animation:!0,templateUrl:'partials/recipes.share.tpl.html',controller:'ModalShareControllerRecipes',size:'xs',resolve:{recipe:function(){return t.recipe;}}});};const o={message:'I recommend '+t.recipe.name,subject:t.recipe.name,url:'https://www.rezept-planer.de/#/sharedrecipe/'+t.recipe._id},c=function(e){e.completed&&n.add('success','Recipe shared with '+e.app);},l=function(e){n.add('danger','Error while sharing: '+e);};t.shareInApp=function(){window.plugins.socialsharing.shareWithOptions(o,c,l);},t.printInApp=function(){const e=document.getElementById('section-to-print');cordova.plugins.printer.print(e,'Recipe.html',function(){alert('printing finished or canceled');});},t.closeSidebar=function(){a.dismiss('cancel');};}]).controller('ActionSidebarRecipeController',['$scope','$aside',function(e,t){e.recipeDetailsView=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.view.links.tpl.html\'"></div>',controller:'RecipeDetailActionSidebarController',placement:'right',size:'sm'});},e.recipeDetailsEdit=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.edit.links.tpl.html\'"></div>',controller:'RecipeDetailActionSidebarController',placement:'right',size:'sm'});},e.recipeDetailsAdd=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.add.links.tpl.html\'"></div>',controller:'RecipeDetailActionSidebarController',placement:'right',size:'sm'});};}]).config(['$stateProvider','modalStateProvider','$urlRouterProvider',function(e,t,i){function r(e,t,i){return{url:t,params:i,views:{'main@user':{templateUrl:'partials/recipes.list.tpl.html',controller:'RecipeListController'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.recipes.details.add"><i class="glyphicon glyphicon-plus"></i></button>',controller:'ActionSidebarRecipeController'}},resolve:{recipes:['Recipes','$stateParams','RecipeListService',function(e,t,i){let r=new Date;r=t.new_recipe?r.setDate(r.getDate()-14):new Date(2015,0,0);const a={author:t.author,updated_at:r,dishType:t.dishType,_id:t.fav_recipe};return e.query(a,function(e){i.setRecipes(e);}).$promise;}],user:['UserService',function(e){return e.getCurrentLoginUser();}],tags:['TagsSelected',function(e){return e.query().$promise;}]},data:{title:e}};}function a(){return{'abstract':!0,url:'/details/:id',views:{'main@user':{templateUrl:'partials/recipes.details.layout.tpl.html'}},resolve:{recipe:['Recipes','$stateParams','RecipeService',function(e,t,i){const r=e.get({id:t.id},function(e){i.setRecipe(e);}).$promise;return r;}],units:['Units',function(e){return e.query().$promise;}],dishtypes:['DishTypes',function(e){return e.query().$promise;}]}};}function s(){return{url:'',params:{factor:null},views:{main:{templateUrl:'partials/recipes.view.tpl.html',controller:'RecipeDetailCtrl'},sidelinks:{templateUrl:'partials/recipes.view.links.tpl.html',controller:'RecipeDetailActionsCtrl'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="recipeDetailsView()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:'ActionSidebarRecipeController'},'actionnavigation-sm@':{template:'<a ng-click="recipeDetailsView()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus padding-right-10"></span>More</a>',controller:'ActionSidebarRecipeController'}}};}function n(e){const t={url:'/edit',views:{}};return t.views['main'+e]={templateUrl:'partials/recipes.edit.form.tpl.html',controller:'RecipeDetailCtrl'},t.views['sidelinks'+e]={templateUrl:'partials/recipes.edit.links.tpl.html',controller:'RecipeDetailActionsCtrl'},t.views['actionnavigation-xs@']={template:'<button type="button" class="navbar-toggle actionbutton" ng-click="update()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:'RecipeDetailActionsCtrl'},t.views['actionnavigation-sm@']={template:'<a ng-click="update()" class="navbar-sm-more"><span class="glyphicon glyphicon-floppy-disk padding-right-10"></span>Save</a>',controller:'RecipeDetailActionsCtrl'},t;}function o(){return{url:'/scheduleadd',templateUrl:'partials/recipes.scheduleadd.tpl.html',controller:'ModalScheduleAddController',params:{
  date:void 0,recipe:void 0},resolve:{randomRecipes:['RandomRecipe',function(e){const t=e.query({number:'3'},function(e){return e;});return t;}]}};}e.state('user.recipes',{url:'/recipes',views:{main:{templateUrl:'partials/recipes.dishtypes.tpl.html',controller:'RecipeDishTypeController'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.recipes.details.add"><i class="glyphicon glyphicon-plus"></i></button>',controller:'ActionSidebarRecipeController'}},resolve:{recipeCount:['$http','BASE_URI',function(e,t){return e.get(t+'api/recipes/count').success(function(e){return e;});}]},data:{title:'Recipes'}}).state('user.recipes.breakfast',r('Breakfast','/breakfast',{dishType:'56294bad07ee48b60ec4405b',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.breakfast.details',a()).state('user.recipes.breakfast.details.view',s()).state('user.recipes.breakfast.details.view.edit',n('@user.recipes.breakfast.details')).state('user.recipes.appetizer',r('Appetizer','/appetizer',{dishType:'562934ae137c052908b75e23',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.appetizer.details',a()).state('user.recipes.appetizer.details.view',s()).state('user.recipes.appetizer.details.view.edit',n('@user.recipes.appetizer.details')).state('user.recipes.drinks',r('Drinks','/drinks',{dishType:'562940bd4bdc01930dca94d8',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.drinks.details',a()).state('user.recipes.drinks.details.view',s()).state('user.recipes.drinks.details.view.edit',n('@user.recipes.drinks.details')).state('user.recipes.salads',r('Salads','/salads',{dishType:'562940db4bdc01930dca94da',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.salads.details',a()).state('user.recipes.salads.details.view',s()).state('user.recipes.salads.details.view.edit',n('@user.recipes.salads.details')).state('user.recipes.maindishes',r('Main Dishes','/maindishes',{dishType:'56293446137c052908b75e22',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.maindishes.details',a()).state('user.recipes.maindishes.details.view',s()).state('user.recipes.maindishes.details.view.edit',n('@user.recipes.maindishes.details')).state('user.recipes.sidedishes',r('Side Dishes','/sidedishes',{dishType:'562940cc4bdc01930dca94d9',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.sidedishes.details',a()).state('user.recipes.sidedishes.details.view',s()).state('user.recipes.sidedishes.details.view.edit',n('@user.recipes.sidedishes.details')).state('user.recipes.desserts',r('Desserts','/desserts',{dishType:'562940ee4bdc01930dca94db',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.desserts.details',a()).state('user.recipes.desserts.details.view',s()).state('user.recipes.desserts.details.view.edit',n('@user.recipes.desserts.details')).state('user.recipes.breads',r('Breads','/breads',{dishType:'562aabc37a696f1229593c42',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.breads.details',a()).state('user.recipes.breads.details.view',s()).state('user.recipes.breads.details.view.edit',n('@user.recipes.breads.details')).state('user.recipes.snacks',r('Snacks','/snacks',{dishType:'5668a3b36faed8e960d4f213',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.snacks.details',a()).state('user.recipes.snacks.details.view',s()).state('user.recipes.snacks.details.view.edit',n('@user.recipes.snacks.details')).state('user.recipes.other',r('Other Recipes','/other',{dishType:'5629f52a2b9118f35b96c2ca',author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.other.details',a()).state('user.recipes.other.details.view',s()).state('user.recipes.other.details.view.edit',n('@user.recipes.other.details')).state('user.recipes.all',r('All Recipes','/all',{dishType:void 0,author:void 0,new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.all.details',a()).state('user.recipes.all.details.view',s()).state('user.recipes.all.details.view.edit',n('@user.recipes.all.details')).state('user.recipes.my',r('My Recipes','/my',{dishType:void 0,author:'self',new_recipe:void 0,fav_recipe:void 0})).state('user.recipes.my.details',a()).state('user.recipes.my.details.view',s()).state('user.recipes.my.details.view.edit',n('@user.recipes.my.details')).state('user.recipes.new',r('New Recipes','/new',{dishType:void 0,author:void 0,new_recipe:!0,fav_recipe:void 0})).state('user.recipes.new.details',a()).state('user.recipes.new.details.view',s()).state('user.recipes.new.details.view.edit',n('@user.recipes.new.details')).state('user.recipes.favorites',r('Favorite Recipes','/favorites',{dishType:void 0,author:void 0,new_recipe:void 0,fav_recipe:!0})).state('user.recipes.favorites.details',a()).state('user.recipes.favorites.details.view',s()).state('user.recipes.favorites.details.view.edit',n('@user.recipes.favorites.details')).state('user.recipes.details',{'abstract':!0,url:'/details/:id',params:{factor:null},views:{'main@user':{templateUrl:'partials/recipes.details.layout.tpl.html'}},resolve:{recipe:['Recipes','$stateParams','RecipeService',function(e,t,i){if(t.id){var r=e.get({id:t.id},function(e){e.ingredients.push({qty:'',unit:'',ingredient:''}),i.setRecipe(e,t.factor);}).$promise;return r;}var r=new e;return r.ingredients=[],r.ingredients.push({qty:'',unit:'',ingredient:''}),r.imagePath='no_image.png',i.data.recipe=r,r;}],units:['Units',function(e){return e.query().$promise;}],dishtypes:['DishTypes',function(e){return e.query().$promise;}]}}).state('user.recipes.details.view',s()).state('user.recipes.details.edit',n()).state('user.recipes.details.add',{url:'^/recipe/add',views:{main:{templateUrl:'partials/recipes.edit.form.tpl.html',controller:'RecipeDetailCtrl'},sidelinks:{templateUrl:'partials/recipes.add.links.tpl.html',controller:'RecipeDetailActionsCtrl'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="save()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:'RecipeDetailActionsCtrl'},'actionnavigation-sm@':{template:'<a ng-click="save()" class="navbar-sm-more"><span class="glyphicon glyphicon-floppy-disk padding-right-10"></span>Save</a>',controller:'RecipeDetailActionsCtrl'}}}).state('anon.recipes',{'abstract':!0,url:'/sharedrecipe',template:'<ui-view />',data:{title:'Recipes'}}).state('anon.recipes.details',{'abstract':!0,url:'/:id',params:{factor:null},templateUrl:'partials/recipes.details.layout.tpl.html',resolve:{recipe:['Recipes','$stateParams','RecipeService',function(e,t,i){if(t.id){var r=e.get({id:t.id},function(e){e.ingredients.push({qty:'',unit:'',ingredient:''}),i.setRecipe(e,t.factor);}).$promise;return r;}var r=new e;return r.ingredients=[],r.ingredients.push({qty:'',unit:'',ingredient:''}),r.imagePath='no_image.png',i.data.recipe=r,r;}],units:function(){return{};},dishtypes:function(){return{};}}}).state('anon.recipes.details.view',{url:'',params:{factor:null},views:{main:{templateUrl:'partials/recipes.view.tpl.html',controller:'RecipeDetailCtrl'},sidelinks:{templateUrl:'partials/recipes.view.links.tpl.html',controller:'RecipeDetailActionsCtrl'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="recipeDetailsView()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:'ActionSidebarRecipeController'},'actionnavigation-sm@':{template:'<a ng-click="recipeDetailsView()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus padding-right-10"></span>More</a>',controller:'ActionSidebarRecipeController'}}}).state('anon.recipes.details.view.edit',n('@anon.recipes.details')),t.state('user.recipes.breakfast.details.view.scheduleadd',o()).state('user.recipes.appetizer.details.view.scheduleadd',o()).state('user.recipes.drinks.details.view.scheduleadd',o()).state('user.recipes.salads.details.view.scheduleadd',o()).state('user.recipes.maindisches.details.view.scheduleadd',o()).state('user.recipes.sidedisches.details.view.scheduleadd',o()).state('user.recipes.desserts.details.view.scheduleadd',o()).state('user.recipes.breads.details.view.scheduleadd',o()).state('user.recipes.snacks.details.view.scheduleadd',o()).state('user.recipes.other.details.view.scheduleadd',o()).state('user.recipes.all.details.view.scheduleadd',o()).state('user.recipes.my.details.view.scheduleadd',o()).state('user.recipes.new.details.view.scheduleadd',o()).state('user.recipes.favorites.details.view.scheduleadd',o()).state('anon.recipes.details.view.scheduleadd',o()).state('user.recipes.breakfast.scheduleadd',o()).state('user.recipes.appetizer.scheduleadd',o()).state('user.recipes.drinks.scheduleadd',o()).state('user.recipes.salads.scheduleadd',o()).state('user.recipes.maindisches.scheduleadd',o()).state('user.recipes.sidedisches.scheduleadd',o()).state('user.recipes.desserts.scheduleadd',o()).state('user.recipes.breads.scheduleadd',o()).state('user.recipes.snacks.scheduleadd',o()).state('user.recipes.other.scheduleadd',o()).state('user.recipes.all.scheduleadd',o()).state('user.recipes.my.scheduleadd',o()).state('user.recipes.new.scheduleadd',o()).state('user.recipes.favorites.scheduleadd',o());}]),angular.module('app.schedules',['ui.router','modalstate']).factory('Schedules',['$resource','BASE_URI',function(e,t){return e(t+'api/schedules/:id',null,{update:{method:'PUT'}});}]).factory('RandomRecipe',['$resource','BASE_URI',function(e,t){return e(t+'api/randomitems/recipes/:number',null,{update:{method:'PUT'}});}]).factory('SchedulesService',['UserService','AlertService','Schedules','$q','$rootScope',function(e,t,r,a,s){var n={schedules:[],selectedDates:[],activeDate:!1},o=function(e){e||(e=new Date),e.setHours(0,0,0,0),n.activeDate=e;},c=function(e,t){e||(n.activeDate||o(),e=n.activeDate),t||(t=7);const r=[];for(i=0;i<t;i++){const a=new Date(e.getTime());a.setDate(a.getDate()+i),a.setHours(0,0,0,0),r.push(a.getTime());}n.selectedDates=r,s.$broadcast('selectedDatesUpdated');},l=function(t){const i=new Date,r=i.getDay(),a=e.data.currentUser.settings.preferredWeekStartDay?e.data.currentUser.settings.preferredWeekStartDay:0;a>r?i.setDate(i.getDate()-i.getDay()+a-7+7*t):i.setDate(i.getDate()-i.getDay()+a+7*t),c(i,7),d();},u=function(){let e=a.defer(),t=Math.min.apply(null,n.selectedDates),s=Math.max.apply(null,n.selectedDates),o=new Date(t);o.setHours(0,0,0,0),o=o.getTime();let c=new Date(s);return c.setDate(c.getDate()+1),c.setHours(0,0,0,0),c=c.getTime(),r.query({startDate:o,endDate:c},function(t){const r=[];for(i=0;i<n.selectedDates.length;i++){var a=new Date(n.selectedDates[i]);a.setHours(0,0,0,0),r[i]={date:a,schedule:[]};}for(i=0;i<t.length;i++){var a=new Date(t[i].date);for(a.setHours(0,0,0,0),j=0;j<n.selectedDates.length;j++)angular.equals(r[j].date,a)&&r[j].schedule.push(t[i]);}e.resolve(r);}),e.promise;},d=function(){u().then(function(e){n.schedules=e,s.$broadcast('schedulesUpdated');});},p=function(e,i){r.remove({id:e._id},function(){const r=n.schedules[i].schedule.indexOf(e);n.schedules[i].schedule.splice(r,1),s.$broadcast('schedulesUpdated');const a='The recipe '+e.recipe.name+' was successfully removed from schedule';t.add('info',a);});};return o(),{data:n,setActiveDate:o,selectPeriod:c,selectWeek:l,update:d,retrieve:u,remove:p};}]).controller('SchedulesController',['$scope','$stateParams','$uibModal','Schedules','schedules','SchedulesService','RandomRecipe',function(e,t,i,r,a,s,n){e.selectedDates=s.data.selectedDates,e.$on('selectedDatesUpdated',function(){e.selectedDates=s.data.selectedDates;}),e.schedulesArray=s.data.schedules,e.$on('schedulesUpdated',function(){e.schedulesArray=s.data.schedules;}),e.activeDate=s.data.activeDate,s.setActiveDate(),e.datepickerOptions={startingDay:1,showWeeks:!1},e.selectSevenDays=function(e){s.selectPeriod(e,7);},e.selectSevenDays(e.activeDate),e.updateSchedules=function(){s.update();},e.selectWeek=function(e){s.selectWeek(e);},e.remove=function(e,t){s.remove(e,t);},e.scheduleEdit=function(e){i.open({animation:!0,templateUrl:'partials/schedules.edit.tpl.html',controller:'ModalScheduleEditController',size:'xs',resolve:{schedule:function(){return e;}}});};}]).controller('ModalScheduleEditController',['$scope','$stateParams','$uibModalInstance','$filter','AlertService','SchedulesService','Schedules','schedule',function(e,t,i,r,a,s,n,o){e.recipe=o.recipe,e.date=o.date,e.factor=o.factor,e.remove=function(){n.remove({id:o._id},function(){const e='The recipe '+o.recipe.name+' was successfully removed from schedule';a.add('info',e),s.update(),i.close();});},e.ok=function(){o.date=e.date,o.factor=e.factor,n.update({id:o._id},o,function(t){const n='The recipe '+e.recipe.name+' was successfully scheduled for the '+r('date')(e.date,'dd.MM.yyyy')+' with '+e.factor+' persons.';a.add('success',n),s.update(),i.close();});},e.cancel=function(){i.dismiss('cancel');};}]).controller('ModalScheduleAddController',['$scope','$state','$stateParams','$uibModalInstance','$filter','AlertService','SchedulesService','Schedules','randomRecipes','TARecipes',function(e,t,i,r,a,s,n,o,c,l){e.date=i.date?i.date:new Date,e.newrecipe=i.recipe?i.recipe:void 0,e.factor=i.recipe&&i.recipe['yield']?i.recipe['yield']:void 0,e.randomRecipes=c,e.datepickerOptions={startingDay:1,showWeeks:!0},e.GetRecipes=function(e){return l.search({search:e}).$promise.then(function(e){return e;});},e.TASelect=function(t){e.factor=t['yield'];},e.selectRecipe=function(t){e.factor||(e.factor=t['yield']),e.newrecipe=t;},e.ok=function(){if(e.newrecipe&&!(e.newrecipe.length<1)){(!e.factor||e.factor.length<1)&&(e.factor=e.recipe['yield']);const i=new o({date:e.date.setHours(12),recipe:e.newrecipe,factor:e.factor});i.$save(function(i){const o='The recipe '+e.newrecipe.name+' was successfully scheduled for the '+a('date')(e.date,'dd.MM.yyyy')+' with '+e.factor+' persons.';s.add('success',o),t.includes('user.schedules')&&n.update(),r.close();});}},e.cancel=function(){r.dismiss('cancel');};}]).config(['$stateProvider','modalStateProvider','$urlRouterProvider',function(e,t,i){e.state('user.schedules',{url:'/schedules',views:{main:{templateUrl:'partials/schedules.tpl.html',controller:'SchedulesController'}},resolve:{schedules:['SchedulesService',function(e){return e.selectPeriod(),e.update();}]},data:{title:'Schedules'}}),t.state('user.schedules.add',{url:'/add',templateUrl:'partials/schedules.add.tpl.html',controller:'ModalScheduleAddController',params:{date:void 0,recipe:void 0},resolve:{randomRecipes:['RandomRecipe',function(e){const t=e.query({number:'3'},function(e){return e;});return t;}]}});}]),angular.module('app.alert',[]).factory('AlertService',function(){function e(e,i){return n.push({type:e,msg:i,close:function(){return t(this);}});}function t(e){return i(n.indexOf(e));}function i(e){return n.splice(e,1);}function r(){n=[];}function a(){return n;}var s={add:e,closeAlert:t,closeAlertIdx:i,clear:r,get:a},n=[];return s;}).controller('AlertController',['$scope','AlertService',function(e,t){e.alerts=t.get();}]),angular.module('app.shopitems',['ui.router','modalstate']).factory('Shopitems',['$resource','BASE_URI',function(e,t){return e(t+'api/shopitems/:id',null,{update:{method:'PUT'}});}]).factory('Frequentshopitems',['$resource','BASE_URI',function(e,t){return e(t+'api/frequentshopitems/');}]).factory('ShopitemService',['$rootScope','$timeout','$q','UserService','Shopitems',function(e,t,r,a,s){let n,o={shopitems:[],alerts:[],autoupdate:!0,pauseAutoupdate:0},c=function(e,t){let i;for(i=0;i<e.length;i++)if(angular.equals(e[i],t))return i;return!1;},l=function(){const t=r.defer();return s.query(function(r){const s=[],n=[],l=a.getCurrentLoginUser();for(i=0;i<r.length;i++){if(r[i].ingredient)var u=l.settings.categoryOrder.indexOf(r[i].ingredient.category)>=0?l.settings.categoryOrder.indexOf(r[i].ingredient.category):99999;else var u=99999;if(r[i].ingredient&&r[i].unit&&r[i].amount){r[i].ingredient.name_translated=r[i].ingredient.name[l.settings.preferredLanguage],r[i].unit.name_translated=r[i].unit.name[l.settings.preferredLanguage];const d={ingredient:r[i].ingredient,unit:r[i].unit,order:u,completed:r[i].completed,details:[],amount:0},p=c(n,d);p===!1?(n.push({ingredient:r[i].ingredient,unit:r[i].unit,order:u,completed:r[i].completed,details:[],amount:0}),d.details.push(r[i]),d.amount=r[i].amount,s.push(d)):(s[p].details.push(r[i]),s[p].amount=r[i].amount+s[p].amount);}}t.resolve(s),o.shopitems=s,e.$broadcast('shopitemsUpdated');}),t.promise;},u=function(e){const t=new Date;t.setDate(t.getDate()+14),t.setHours(0,0,0,0);const i=new s({ingredient:e.ingredient,unit:e.unit,amount:e.amount,completed:!1,expire_date:t});i.$save(),o.shopitems.push({ingredient:e.ingredient,unit:e.unit,completed:e.completed,details:[e],amount:e.amount});},d=function(i){if(o.pauseAutoupdate=o.pauseAutoupdate+1,i){const r=c(o.shopitems,i);if(r===!1)o.alerts.push({type:'danger',msg:'Match not found in existing shopping list, please inform the developer.'});else for(let a=i.details.length-1;a>=0;a--)s.remove({id:i.details[a]._id},null,function(e){for(var t,i=0;i<o.shopitems[r].details.length;i++)o.shopitems[r].details[i]._id==e._id&&(t=i);o.shopitems[r].details.splice(t,1),0===o.shopitems[r].details.length&&o.shopitems.splice(r,1);},function(e){o.alerts.push({type:'danger',msg:'Network connection error'});});}else s.remove({},null,function(t){o.shopitems=[],e.$broadcast('shopitemsUpdated');},function(e){o.alerts.push({type:'danger',msg:'Network connection error'});});t(function(){o.pauseAutoupdate=o.pauseAutoupdate-1;},5e3);},p=function(e){o.pauseAutoupdate=o.pauseAutoupdate+1;const i=c(o.shopitems,e);if(i===!1)o.alerts.push({type:'danger',msg:'Match not found in existing shopping list, please inform the developer.'});else{e.completed=!e.completed;for(let r=e.details.length-1;r>=0;r--)s.update({id:e.details[r]._id},{completed:e.completed},function(t){for(var r,a=0;a<o.shopitems[i].details.length;a++)o.shopitems[i].details[a]._id==t._id&&(r=a);o.shopitems[i].details[r].completed=e.completed;},function(e){o.alerts.push({type:'danger',msg:'Network connection error'});});o.shopitems[i].completed=e.completed;}t(function(){o.pauseAutoupdate=o.pauseAutoupdate-1;},5e3);},m=function(){o.autoupdate===!0&&o.pauseAutoupdate<=0?(l(),this.timer=t(function(){m();},5e3)):o.autoupdate===!1?t.cancel(n):this.timer=t(function(){m();},5e3);},f=function(){o.autoupdate!==!1&&this.timer||(o.autoupdate=!0,e.$broadcast('autoupdateValueChanged'),m());},g=function(){o.autoupdate=!1,e.$broadcast('autoupdateValueChanged'),t.cancel(n);};return{data:o,retrieveShopitems:l,addShopitem:u,remove:d,complete:p,startAutoupdate:f,stopAutoupdate:g};}]).controller('ShopitemsController',['$scope','$uibModal','ShopitemService','Shopitems','frequentshopitems','TAIngredients','units','shopitems',function(e,t,r,a,s,n,o,c){for(e.units=o,e.frequentshopitems=s,e.shopitems=r.data.shopitems,e.autoupdate=r.data.autoupdate,e.alerts=r.data.alerts,e.$on('shopitemsUpdated',function(){e.shopitems=r.data.shopitems;}),e.$on('autoupdateValueChanged',function(){e.autoupdate=r.data.autoupdate;}),e.status=[],i=0;i<e.shopitems.length;i++)e.status[e.shopitems[i].ingredient.category]=!0;e.addShopitem=function(e){r.addShopitem(e);},e.remove=function(e){r.remove(e);},e.complete=function(e){r.complete(e);},e.startAutoupdate=function(){r.startAutoupdate();},e.stopAutoupdate=function(){r.stopAutoupdate();},e.autoupdate===!0&&e.startAutoupdate(),e.$on('$destroy',function(t){e.stopAutoupdate();}),e.GetIngredients=function(e){return n.search({search:e,language:'de'}).$promise.then(function(e){return e;});},e.shopitemDetails=function(i){const a=t.open({animation:!0,templateUrl:'partials/shopitems.modal.details.tpl.html',controller:'ModalShopitemDetailsController',size:'lg',resolve:{item:function(){return i;},units:function(){return e.units;}}});a.result.then(function(){r.retrieveShopitems();});},e.closeAlert=function(t){e.alerts.splice(t,1);};}]).controller('ShopitemsActionController',['$scope','$uibModal','ShopitemService','units',function(e,t,i,r){e.units=r,e.autoupdate=i.data.autoupdate,e.alerts=i.data.alerts,e.$on('autoupdateValueChanged',function(){e.autoupdate=i.data.autoupdate;}),e.addShopitem=function(e){i.addShopitem(e);},e.remove=function(e){i.remove(e);},e.startAutoupdate=function(){i.startAutoupdate();},e.stopAutoupdate=function(){i.stopAutoupdate();};}]).controller('ShopitemsActionSidebarController',['$scope','$uibModal','ShopitemService','units','$uibModalInstance','isCordova',function(e,t,i,r,a,s){e.isCordova=s,e.units=r,e.autoupdate=i.data.autoupdate,e.alerts=i.data.alerts,e.$on('autoupdateValueChanged',function(){e.autoupdate=i.data.autoupdate;}),e.printingAvailable=cordova.plugins.printer.isAvailable(function(e){return e;}),e.printInApp=function(){const e=document.getElementById('section-to-print');cordova.plugins.printer.print(e,'Shopitems.html',function(){alert('printing finished or canceled');});},e.addShopitem=function(e){i.addShopitem(e);},e.remove=function(e){i.remove(e);},e.startAutoupdate=function(){i.startAutoupdate();},e.stopAutoupdate=function(){i.stopAutoupdate();},e.closeSidebar=function(){a.dismiss('cancel');};}]).controller('ModalShopitemDetailsController',['$scope','$stateParams','$uibModalInstance','item','Shopitems',function(e,t,i,r,a){e.item=r,e.complete=function(t){t.completed=!t.completed,a.update({id:t._id},{completed:t.completed},function(i){for(let r=0;r<e.item.details.length;r++)e.item.details[r]._id==i._id&&(e.item.details[r].completed=t.completed);},function(e){});},e.remove=function(t){t.completed=!t.completed,a.remove({id:t._id},null,function(t){for(let i=0;i<e.item.details.length;i++)e.item.details[i]._id==t._id&&e.item.details.splice(i,1);},function(e){});},e.close=function(){i.close();};}]).controller('ModalShopitemAddController',['$scope','$stateParams','$uibModalInstance','TAIngredients','units','ShopitemService',function(e,t,r,a,s,n){e.submitted=!1,e.units=s,e.newunit=t.unit?t.unit._id:void 0,e.newingredient=t.ingredient?t.ingredient:void 0,e.GetIngredients=function(e){return a.search({search:e,language:'de'}).$promise.then(function(e){return e;});},e.ok=function(t){if(!t)return void(e.submitted=!0);for(i=0;i<e.units.length;i++)e.units[i]._id===e.newunit&&(e.newunitobject=e.units[i]);const a={amount:e.newamount,unit:e.newunitobject,ingredient:e.newingredient};n.addShopitem(a),r.close();},e.cancel=function(){r.dismiss('cancel');};}]).controller('ActionSidebarShopitemsController',['$scope','$aside','units',function(e,t,i){e.shopitemsActions=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/shopitems.links.tpl.html\'"></div>',controller:'ShopitemsActionSidebarController',placement:'right',size:'sm',resolve:{units:function(){return i;}}});};}]).config(['$stateProvider','modalStateProvider','$urlRouterProvider',function(e,t,i){e.state('user.shopitems',{'abstract':!0,url:'/shopitems',views:{main:{templateUrl:'partials/shopitems.layout.tpl.html'}},resolve:{shopitems:['ShopitemService',function(e){return e.data.autoupdate=!0,e.retrieveShopitems().then(function(e){return e;});}],frequentshopitems:['Frequentshopitems',function(e){return e.query().$promise;}],units:['Units',function(e){return e.query().$promise;}]},data:{title:'Shopping'}}).state('user.shopitems.view',{url:'',views:{main:{templateUrl:'partials/shopitems.tpl.html',controller:'ShopitemsController'},sidelinks:{templateUrl:'partials/shopitems.links.tpl.html',controller:'ShopitemsActionController'},'actionnavigation-xs@':{template:'<button type="button" class="navbar-toggle visible-xs actionbutton" ng-click="shopitemsActions()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:'ActionSidebarShopitemsController'},'actionnavigation-sm@':{template:'<a ng-click="shopitemsActions()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus padding-right-10"></span>More</a>',controller:'ActionSidebarShopitemsController'}}}),t.state('user.shopitems.view.add',{url:'/add',templateUrl:'partials/shopitems.modal.add.tpl.html',controller:'ModalShopitemAddController',params:{ingredient:void 0,unit:void 0},resolve:{units:['Units',function(e){return e.query().$promise;}]}});}]),angular.module('app.units',['ui.router']).factory('Units',['$resource','BASE_URI',function(e,t){return e(t+'api/units/:id',null,{update:{method:'PUT'}});}]).controller('UnitsController',['$scope','units',function(e,t){e.units=t;}]).controller('UnitDetailCtrl',['$scope','$stateParams','unit','Units','$state',function(e,t,i,r,a){e.unit=i,e.update=function(){r.update({id:e.unit._id},e.unit,function(){a.go('admin.units.list');});},e.remove=function(){r.remove({id:e.unit._id},function(){a.go('admin.units.list');});},e.save=function(){if(e.newunit&&!(e.newunit.length<1)){const t=new r({name:{en:e.newunit.name.en,de:e.newunit.name.de,fi:e.newunit.name.fi}});t.$save(function(){a.go('admin.units.list');});}};}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('admin.units',{'abstract':!0,url:'/units',template:'<ui-view />',data:{title:'Units'}}).state('admin.units.list',{url:'/list',templateUrl:'partials/units.tpl.html',controller:'UnitsController',resolve:{units:['Units',function(e){return e.query().$promise;}]},data:{name:'Units',icon:'glyphicon glyphicon-scale'}}).state('admin.units.edit',{url:'/edit/:id',templateUrl:'partials/units.details.tpl.html',controller:'UnitDetailCtrl',resolve:{unit:['Units','$stateParams',function(e,t){const i=e.get({id:t.id},function(e){return e;}).$promise;return i;}]}}).state('admin.units.add',{url:'/add',templateUrl:'partials/units.add.tpl.html',controller:'UnitDetailCtrl',resolve:{unit:['Units',function(e){const t=new e;return t;}]}});}]),angular.module('app.tags',['ui.router']).factory('Tags',['$resource','BASE_URI',function(e,t){return e(t+'api/tags/:id',null,{update:{method:'PUT'}});}]).controller('TagsController',['$scope','tags',function(e,t){e.tags=t;}]).controller('TagDetailCtrl',['$scope','$stateParams','tag','Tags','$state',function(e,t,i,r,a){e.tag=i,e.update=function(){r.update({id:e.tag._id},e.tag,function(){a.go('admin.tags.list');});},e.remove=function(){r.remove({id:e.tag._id},function(){a.go('admin.tags.list');});},e.save=function(){if(e.newtag&&!(e.newtag.length<1)){const t=new r({text:e.newtag.text});t.$save(function(){a.go('admin.tags.list');});}};}]).config(['$stateProvider','$urlRouterProvider',function(e,t){e.state('admin.tags',{'abstract':!0,url:'/tags',template:'<ui-view />',data:{title:'Tags'}}).state('admin.tags.list',{url:'/list',templateUrl:'partials/tags.tpl.html',controller:'TagsController',resolve:{tags:['Tags',function(e){return e.query().$promise;}]},data:{name:'Tags',icon:'glyphicon glyphicon-tags'}}).state('admin.tags.edit',{url:'/edit/:id',templateUrl:'partials/tags.details.tpl.html',controller:'TagDetailCtrl',resolve:{tag:['Tags','$stateParams',function(e,t){const i=e.get({id:t.id},function(e){return e;}).$promise;return i;}]}}).state('admin.tags.add',{url:'/add',templateUrl:'partials/tags.add.tpl.html',controller:'TagDetailCtrl',resolve:{tag:['Tags',function(e){const t=new e;return t;}]}});}]);