angular.module("app",["app.auth","app.recipes","app.schedules","app.shopitems","app.units","app.ingredients","app.dishtypes","app.admin","app.alert","ui.router","ngAnimate","ngResource","ngStorage","ui.bootstrap","ngTagsInput","angular.filter","ngAside","angular-spinkit","gm.datepickerMultiSelect","720kb.socialshare","as.sortable"]).constant("BASE_URI","https://www.rezept-planer.de/").factory("navigationMenu",["$state",function(e){var t=[],i=e.get();return angular.forEach(i,function(e){e.data&&e.data.name&&t.push({path:e.url,name:e.name,label:e.data.name,icon:e.data.icon?e.data.icon:null,panelright:e.data.panelright?e.data.panelright:!1,requiresLogin:e.data.requiresLogin?e.data.requiresLogin:!1,requiredPermissions:e.data.requiredPermissions?e.data.requiredPermissions.join():void 0})}),{states:t}}]).factory("navigationTitle",["$state",function(e){var t={title:""};return{getObject:function(){return t}}}]).factory("httpPostFactory",["$http","BASE_URI",function(e,t){return function(i,r,s){e({url:t+i,method:"POST",data:r,headers:{"Content-Type":void 0}}).success(function(e){s(e)})}}]).factory("isCordova",function(){var e=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");return!!e}).controller("NavbarController",["$scope","navigationTitle",function(e,t){e.navObject=t.getObject()}]).controller("NavSidebarController",["$scope","$uibModalInstance",function(e,t){e.cancel=function(){t.dismiss("cancel")}}]).controller("StartpageController",["$scope",function(e){e.openLink=function(e){window.open(e)}}]).directive("navsidebar",["$aside","UserService",function(e,t){return{restrict:"E",replace:!0,templateUrl:"partials/navigation.sidebar.button.tpl.html",controller:["$scope","$state",function(t,i){t.showBackNav=function(){return i.includes("user.recipes")&&i.$current.path.length>2},t.onClick=function(){if(this.showBackNav()){to=i.$current;do to=to.parent;while(to["abstract"]);return i.transitionTo(to,{},{inherit:!0,relative:i.$current})}e.open({templateUrl:"partials/navigation.sidebar.tpl.html",controller:"NavSidebarController",placement:"left",size:"lg"})}}]}}]).directive("access",["$rootScope","UserService",function(e,t){return{restrict:"A",link:function(i,r,s){var a=function(){r.removeClass("hidden")},n=function(){r.addClass("hidden")},o=function(e){var i;e&&a(),i=t.authorize(void 0,c),0===i?a():n()},c=s.access.split(",");c.length>0&&o(!0),e.$on("$stateChangeSuccess",function(){c.length>0&&o(!0)})}}}]).directive("ngReallyClick",["$uibModal",function(e){return{restrict:"A",scope:{ngReallyClick:"&"},link:function(t,i,r){i.bind("click",function(){if(t.$parent.schedule&&t.$parent.schedule.recipe&&t.$parent.schedule.recipe.name)var i="Are you sure to delete the recipe "+t.$parent.schedule.recipe.name+" from schedule?";else if(t.$parent.recipe&&t.$parent.recipe.name)var i="Are you sure to delete the recipe "+t.$parent.recipe.name+"?";else var i=r.ngReallyMessage||"Are you sure?";var s=e.open({animation:!0,templateUrl:"partials/ngreally.tpl.html",controller:["$scope","$uibModalInstance","message",function(e,t,i){e.message=i,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}],size:"xs",resolve:{message:function(){return i}}});s.result.then(function(){t.ngReallyClick()})})}}}]).directive("ngImageUpload",["httpPostFactory",function(e){return{restrict:"A",scope:!0,link:function(t,i,r){i.bind("change",function(){var r=new FormData;r.append("file",i[0].files[0]),e("api/upload",r,function(e){console.log(e),t.recipe.imagePath=e})})}}}]).directive("cameraButton",["httpPostFactory",function(e){return{restrict:"A",scope:!0,link:function(t,i,r){i.bind("click",function(){navigator.camera.getPicture(function(i){window.resolveLocalFileSystemURL(i,function(i){i.file(function(i){var r=new FileReader;r.onloadend=function(r){var s=new Blob([r.target.result],{type:i.type}),a=new FormData;a.append("file",s,"file.jpg"),e("api/upload",a,function(e){t.recipe.imagePath=e})},r.readAsArrayBuffer(i)},function(e){})},function(e){})},function(e){},{quality:50,destinationType:Camera.DestinationType.FILE_URI})})}}}]).directive("stateLoadingIndicator",["$rootScope",function(e){return{restrict:"E",template:"<div ng-show='isStateLoading' class='loading-indicator overlay'><div class='loading-indicator-body'><div class='spinner'><double-bounce-spinner></double-bounce-spinner></div></div></div>",replace:!0,link:function(t,i,r){t.isStateLoading=!1,e.$on("$stateChangeStart",function(){t.isStateLoading=!0}),e.$on("$stateChangeSuccess",function(){t.isStateLoading=!1})}}}]).filter("timeFilter",function(){var e={ss:angular.identity,mm:function(e){return 60*e},hh:function(e){return 3600*e}};return function(t,i){var r=e[i||"ss"](t),s=Math.floor(r/3600),a=Math.floor(r%3600/60);return s=s>0?s:"",format=""==s?"mm min":"hhh mmm",format.replace(/hh/,s).replace(/mm/,a)}}).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("anon",{"abstract":!0,views:{root:{template:"<ui-view />"}},data:{requiresLogin:!1,requiredPermissions:["NoUser"]}}).state("anon.startpage",{url:"/",templateUrl:"partials/startpage.tpl.html",controller:"StartpageController",data:{title:"rezept-planer.de"}}).state("anon.user",{url:"/user","abstract":!0,template:"<ui-view />"}).state("user",{"abstract":!0,views:{root:{template:'<div ui-view="main"></div>'}},data:{requiresLogin:!0,requiredPermissions:["User"]}}).state("impressum",{url:"/impressum",views:{root:{templateUrl:"partials/impressum.tpl.html"}},data:{title:"Impressum"}}).state("accessdenied",{url:"/access/denied",views:{root:{templateUrl:"partials/access.denied.tpl.html"}}}).state("user.home",{url:"/home",views:{main:{templateUrl:"partials/home.tpl.html"}},data:{title:"Home"}})}]).run(["$rootScope","$state","$stateParams","$http","UserService","navigationTitle","BASE_URI",function(e,t,i,r,s,a,n){e.$state=t,e.$stateParams=i,e.print=function(e){window.print()},e.$on("$stateChangeStart",function(i,o,c,l,u){e.previousState=l?l:{},e.previousState.name=l.name?l.name:"user.home",e.previousStateParams=u?u:{};var d=s.isAuthenticated();if(d===!0&&(r.get(n+"api/user/check"),"anon.startpage"==o.name&&(i.preventDefault(),t.go("user.home"))),o.data&&o.data.title){var p=a.getObject();p.title=o.data.title}}),e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0})}]),angular.module("app.admin",["ui.router"]).factory("Users",["$resource","BASE_URI",function(e,t){return e(t+"api/admin/user/:id",null,{update:{method:"PUT"}})}]).controller("AdminUserCtrl",["$scope","$state","users","Users",function(e,t,i,r){e.users=i,e.remove=function(t){r.remove({id:t._id},function(){e.users.splice(e.users.indexOf(t),1)})},e.activate=function(t){e.users[e.users.indexOf(t)].is_activated=!0,r.update({id:t._id},{is_activated:!0},function(){})},e.makeAdmin=function(t){e.users[e.users.indexOf(t)].is_admin=!0,r.update({id:t._id},{is_admin:!0},function(){})},e.removeAdmin=function(t){e.users[e.users.indexOf(t)].is_admin=!1,r.update({id:t._id},{is_admin:!1},function(){})}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("admin",{"abstract":!0,views:{root:{template:"<ui-view />"}},data:{requiresLogin:!0,requiredPermissions:["Admin"],title:"Admin"}}).state("admin.user",{url:"/admin/user",templateUrl:"partials/admin.user.tpl.html",controller:"AdminUserCtrl",resolve:{users:["Users",function(e){return e.query().$promise}]},data:{title:"Users"}})}]),angular.module("app.auth",["ui.router"]).factory("User",["$resource","BASE_URI",function(e,t){return e(t+"api/user/info/:id",null,{update:{method:"PUT"}})}]).factory("UserService",["$localStorage","$injector",function(e,t){var i={currentUser:{},currentUserCopy:{},languageOptions:[{id:"en",name:"English"},{id:"de",name:"Deutsch"},{id:"fi",name:"Suomi"}],weekdayOptions:[{id:0,name:"Sunday"},{id:1,name:"Monday"},{id:2,name:"Tueasday"},{id:3,name:"Wednesday"},{id:4,name:"Thursday"},{id:5,name:"Friday"},{id:6,name:"Saturday"}]},r=function(t){i.currentUser=t,i.currentUserCopy=angular.copy(i.currentUser),e.user=t},s=function(){return i.currentUser},a=function(){delete i.currentUser,delete i.currentUserCopy,delete e.user},n=function(){return angular.isObject(i.currentUser)&&"_id"in i.currentUser},o=function(){return i.currentUser&&i.currentUser.token?i.currentUser.token:void 0},c=function(e,t,i){var r,a,o=0,c=s(),l=n(),u=[],d=!0;if(i=i||0,e===!0&&void 0===c)o=1;else if(e!==!0||l!==!0||void 0!==t&&0!==t.length){if(t){for(l===!1&&(c={permissions:["NoUser"]}),u=[],angular.forEach(c.permissions,function(e){u.push(e.toLowerCase())}),a=0;a<t.length;a+=1)if(r=t[a].toLowerCase(),1===i){if(d=d&&u.indexOf(r)>-1,d===!1)break}else if(0===i&&(d=u.indexOf(r)>-1))break;o=d?0:2}}else o=0;return o},l=function(t){void 0!==i.currentUser&&(i.currentUser.favoriteRecipes=t,i.currentUserCopy=angular.copy(i.currentUser),e.user.favoriteRecipes=t)},u=function(e){if(void 0!==i.currentUser){var r=t.get("User");r.update({id:i.currentUser._id},{fullname:i.currentUserCopy.fullname,settings:i.currentUserCopy.settings},function(t){for(var r in t)i.currentUser[r]=t[r];i.currentUserCopy=angular.copy(i.currentUser),e()})}};return e.user&&r(e.user),{data:i,createUser:r,getCurrentLoginUser:s,deleteCurrentUser:a,isAuthenticated:n,getToken:o,authorize:c,updateFavoriteRecipes:l,updateUserSettings:u}}]).factory("AuthenticationService",["$http","$localStorage","$state","$stateParams","$rootScope","UserService","BASE_URI","AlertService",function(e,t,i,r,s,a,n,o){var c=function(t,r,s){void 0!==t&&void 0!==r?e.post(n+"api/user/login",{username:t,password:r,autologin:s}).success(function(e){e.permissions=["User"],e.is_admin&&e.permissions.push("Admin"),a.createUser(e),i.go("user.home")}).error(function(e){o.add("danger","Network or certificate error")}):o.add("danger"," Please fill out username and password.")},l=function(){e.get(n+"api/user/logout").success(function(){a.deleteCurrentUser(),o.add("success","You hav been successfully loged out."),i.go("anon.startpage")}).error(function(){o.add("danger","Network connection error."),i.go(s.previousState.name,s.previousStateParams)})},u=function(t){e.post(n+"api/user/register",t).success(function(){o.add("success"," Please check your email to confirm your address and to activate your account."),i.go("anon.user.login")}).error(function(e){o.add("danger","Network or certificate error.")})},d=function(){r&&r.token&&e.get(n+"api/user/confirm/"+r.token).success(function(e){o.add("success","Email has been successfully confirmed. You are now able to login with your credentials."),i.go("anon.user.login")}).error(function(e){o.add("danger","Network or certificate error.")})},p=function(t){return void 0!==t?e.post(n+"api/user/forgot",{username:t}).success(function(e){o.add("success","Password renewal process has been started. Please check your email for further instructions."),i.go("anon.user.login")}):void o.add("danger","Please enter username.")},m=function(t,s){return void 0!==t&&t===s?e.put(n+"api/user/reset/"+r.token,{password:t,passwordConfirmation:s}).success(function(e){o.add("success","Password has been reset successfully. Please use the new password to login."),i.go("anon.user.login")}):void o.add("danger","Please enter the same password into password and password confirmation.")};return{logIn:c,logOut:l,register:u,confirmEmail:d,requestNewPassword:p,resetPassword:m}}]).factory("TokenInterceptor",["$q","UserService","$injector","AlertService",function(e,t,i,r){return{request:function(e){return e.headers=e.headers||{},t.isAuthenticated()===!0&&(e.headers.Authorization="AUTH "+t.getToken()),e},requestError:function(t){return e.reject(t)},response:function(t){return null!=t&&200==t.status,t||e.when(t)},responseError:function(s){if(null!=s&&401===s.status){t.deleteCurrentUser(),r.add("danger","Access denied!");var a=i.get("$state");a.go("anon.startpage")}return e.reject(s)}}}]).controller("UserAuthenticationController",["$scope","Users","AuthenticationService","UserService",function(e,t,i,r){e.languageOptions=r.data.languageOptions,e.weekdayOptions=r.data.weekdayOptions,e.user=new t,e.logIn=function(){i.logIn(e.login.username,e.login.password,e.login.autologin)},e.register=function(){i.register(e.user)}}]).controller("UserConfirmEmailController",["AuthenticationService",function(e){e.confirmEmail()}]).controller("UserLogoutController",["AuthenticationService",function(e){e.logOut()}]).controller("UserPasswordRenewalController",["$scope","AuthenticationService",function(e,t){e.requestNewPassword=function(e){t.requestNewPassword()},e.resetPassword=function(e,i){t.resetPassword()}}]).controller("UserSettingsController",["$scope","$state","UserService","AlertService",function(e,t,i,r){e.languageOptions=i.data.languageOptions,e.weekdayOptions=i.data.weekdayOptions,i.data.currentUserCopy=angular.copy(i.data.currentUser),e.user=i.data.currentUserCopy,e.updateUserSettings=function(){i.updateUserSettings(function(){r.add("success","Settings successfully updated."),t.go("user.settings")})}}]).config(["$httpProvider",function(e){e.interceptors.push("TokenInterceptor")}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("anon.user.register",{url:"/register",templateUrl:"partials/user.register.tpl.html",controller:"UserAuthenticationController",data:{title:"Register"}}).state("anon.user.confirm",{url:"/confirm/:token",controller:"UserConfirmEmailController",data:{title:"Confirm Email"}}).state("anon.user.login",{url:"/login",templateUrl:"partials/user.login.tpl.html",controller:"UserAuthenticationController",data:{title:"Login"}}).state("user.logout",{url:"/user/logout",views:{main:{template:'<div class="loading-indicator overlay"><div class="loading-indicator-body"><div class="spinner"><double-bounce-spinner></double-bounce-spinner></div></div></div>',controller:"UserLogoutController"}},data:{title:"Logout"}}).state("anon.forgot",{url:"/user/forgot",templateUrl:"partials/user.forgot.tpl.html",controller:"UserPasswordRenewalController",data:{title:"Forgot password"}}).state("anon.reset",{url:"/user/reset/:token",templateUrl:"partials/user.reset.tpl.html",controller:"UserPasswordRenewalController",data:{title:"Reset password"}}).state("user.settings",{url:"/user/settings",views:{main:{templateUrl:"partials/user.settings.view.tpl.html",controller:"UserSettingsController"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.settings.edit"><i class="glyphicon glyphicon-pencil"></i></button>'}},data:{title:"User settings"}}).state("user.settings.edit",{url:"/edit",views:{"main@user":{templateUrl:"partials/user.settings.edit.tpl.html",controller:"UserSettingsController"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="updateUserSettings()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:"UserSettingsController"}}})}]),angular.module("app.dishtypes",["ui.router"]).factory("DishTypes",["$resource","BASE_URI",function(e,t){return e(t+"api/dishtypes/:id",null,{update:{method:"PUT"}})}]).controller("DishTypesController",["$scope","dishtypes",function(e,t){e.dishtypes=t}]).controller("DishTypeDetailCtrl",["$scope","$stateParams","dishtype","DishTypes","$state",function(e,t,i,r,s){e.dishtype=i,e.update=function(){r.update({id:e.dishtype._id},e.dishtype,function(){s.go("admin.dishtypes.list")})},e.remove=function(){r.remove({id:e.dishtype._id},function(){s.go("admin.dishtypes.list")})},e.save=function(){if(e.newdishtype&&!(e.newdishtype.length<1)){var t=new r({name:{en:e.newdishtype.name.en,de:e.newdishtype.name.de,fi:e.newdishtype.name.fi},order:e.newdishtype.order,imagePath:e.newdishtype.imagePath});t.$save(function(){s.go("admin.dishtypes.list")})}}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("admin.dishtypes",{"abstract":!0,url:"/dishtypes",template:"<ui-view />",data:{title:"Dish types"}}).state("admin.dishtypes.list",{url:"/list",templateUrl:"partials/dishtypes.tpl.html",controller:"DishTypesController",resolve:{dishtypes:["DishTypes",function(e){return e.query().$promise}]},data:{name:"Dish types",icon:"glyphicon glyphicon-grain"}}).state("admin.dishtypes.edit",{url:"/edit/:id",templateUrl:"partials/dishtypes.details.tpl.html",controller:"DishTypeDetailCtrl",resolve:{dishtype:["DishTypes","$stateParams",function(e,t){var i=e.get({id:t.id},function(e){return e}).$promise;return i}]}}).state("admin.dishtypes.add",{url:"/add",templateUrl:"partials/dishtypes.add.tpl.html",controller:"DishTypeDetailCtrl",resolve:{dishtype:["DishTypes",function(e){var t=new e;return t}]}})}]),angular.module("app.ingredients",["ui.router"]).factory("Ingredients",["$resource","BASE_URI",function(e,t){return e(t+"api/ingredients/:id",null,{update:{method:"PUT"}})}]).factory("TAIngredients",["$resource","BASE_URI",function(e,t){return e(t+"api/typeahead/ingredients/",null,{search:{method:"GET",isArray:!0}})}]).factory("Categories",["$resource","BASE_URI",function(e,t){return e(t+"api/categories/:id",null,{update:{method:"PUT"}})}]).controller("IngredientsController",["$scope","ingredients",function(e,t){e.ingredients=t}]).controller("IngredientDetailCtrl",["$scope","$stateParams","ingredient","Ingredients","categories","$state",function(e,t,i,r,s,a){e.categories=s,e.selectedcategory={},e.ingredient=i,e.selectedcategory.category=i.category,e.selectedcategory.subcategory=i.subcategory,e.selectedcategory.subsubcategory=i.subsubcategory,e.selectedcategory.rewe_cat_id=i.rewe_cat_id,e.update=function(){e.ingredient.category=e.selectedcategory.category,e.ingredient.subcategory=e.selectedcategory.subcategory,e.ingredient.subsubcategory=e.selectedcategory.subsubcategory,e.ingredient.rewe_cat_id=e.selectedcategory.rewe_cat_id,r.update({id:e.ingredient._id},e.ingredient,function(){a.go("admin.ingredients.list")})},e.remove=function(){r.remove({id:e.ingredient._id},function(){a.go("admin.ingredients.list")})},e.save=function(){if(e.newingredient&&!(e.newingredient.length<1)){e.newingredient.category=e.selectedcategory.category,e.newingredient.subcategory=e.selectedcategory.subcategory,e.newingredient.subsubcategory=e.selectedcategory.subsubcategory,e.newingredient.rewe_cat_id=e.selectedcategory.rewe_cat_id;var t=new r(e.newingredient);t.$save(function(){a.go("admin.ingredients.list")})}}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("admin.ingredients",{"abstract":!0,url:"/ingredients",template:"<ui-view />",data:{title:"Ingredients"}}).state("admin.ingredients.list",{url:"/list",templateUrl:"partials/ingredients.tpl.html",controller:"IngredientsController",resolve:{ingredients:["Ingredients",function(e){return e.query().$promise}]},data:{name:"Ingredients",icon:"glyphicon glyphicon-apple"}}).state("admin.ingredients.edit",{url:"/edit/:id",templateUrl:"partials/ingredients.details.tpl.html",controller:"IngredientDetailCtrl",resolve:{ingredient:["Ingredients","$stateParams",function(e,t){var i=e.get({id:t.id},function(e){return e}).$promise;return i}],categories:["Categories",function(e){return e.query().$promise}]}}).state("admin.ingredients.add",{url:"/add",templateUrl:"partials/ingredients.add.tpl.html",controller:"IngredientDetailCtrl",resolve:{ingredient:["Ingredients",function(e){var t=new e;return t}],categories:["Categories",function(e){return e.query().$promise}]}})}]),angular.module("app.recipes",["ui.router","modalstate","app.alert"]).factory("Recipes",["$resource","BASE_URI",function(e,t){return e(t+"api/recipes/:id",null,{update:{method:"PUT"}})}]).factory("TARecipes",["$resource","BASE_URI",function(e,t){return e(t+"api/typeahead/recipes/",null,{search:{method:"GET",isArray:!0}})}]).factory("Tags",["$resource","BASE_URI",function(e,t){return e(t+"api/tags/:id",null,{update:{method:"PUT"}})}]).factory("TATags",["$resource","BASE_URI",function(e,t){return e(t+"api/typeahead/tags/",null,{search:{method:"GET",isArray:!0}})}]).factory("Favorites",["$resource","BASE_URI",function(e,t){return e(t+"api/user/favorites/:id",null,{update:{method:"PUT"}})}]).factory("RecipeService",["$rootScope","$stateParams","$uibModal","AlertService","Recipes","$state","Favorites","UserService","Tags",function(e,t,r,s,a,n,o,c,l){var u={recipe:{},recipeOrig:{},factorAvailable:!1,factor:0,userExists:!1,allowEdit:!1,submitted:!1,validForm:!1},d=function(e,t){u.recipe=e,u.recipeOrig=angular.copy(u.recipe),u.factorAvailable=t>0,u.factor=u.factorAvailable?t:u.recipe["yield"];var i=c.getCurrentLoginUser();u.recipe.author&&i&&i._id==u.recipe.author._id||i&&i.is_admin===!0?(u.userExists=!0,u.allowEdit=!0):i&&(u.userExists=!0)},p=function(){if(!u.validForm)return s.add("danger","Please complete all required fields before saving."),u.submitted=!0,void e.$broadcast("submittedValueChanged");if(u.recipe&&!(u.recipe.length<1)){for(u.recipe.ingredients=u.recipe.ingredients.filter(function(e){return""!=e}),i=0;i<u.recipe.tags.length;i++)if(!u.recipe.tags[i]._id){var t=new l(u.recipe.tags[i]);t.$save(),u.recipe.tags[i]=t._id}for(i=0;i<u.recipe.ingredients.length;i++)u.recipe.ingredients[i].ingredient&&u.recipe.ingredients[i].ingredient._id||u.recipe.ingredients.splice(i,1);delete u.recipe._id,u.recipe.$save(function(e){n.go("user.recipes.details.view",{id:e._id})})}},m=function(){if(!u.validForm)return s.add("danger","Please complete all required fields before saving."),u.submitted=!0,void e.$broadcast("submittedValueChanged");for(i=0;i<u.recipe.tags.length;i++)if(!u.recipe.tags[i]._id){var t=new l(u.recipe.tags[i]);t.$save(),u.recipe.tags[i]=t._id}for(u.recipe.ingredients=u.recipe.ingredients.filter(function(e){return""!=e}),i=0;i<u.recipe.ingredients.length;i++)u.recipe.ingredients[i].ingredient&&u.recipe.ingredients[i].ingredient._id||u.recipe.ingredients.splice(i,1);a.update({id:u.recipe._id},u.recipe,function(t){d(t),n.go(e.previousState.name,e.previousStateParams)})},f=function(){a.remove({id:u.recipe._id},function(){"user.recipes.details.edit"===e.previousState.name?n.go("user.recipes.dishtypes"):n.go(e.previousState.name,e.previousStateParams)})},h=function(){u.recipe=angular.copy(u.recipeOrig),n.go(e.previousState.name,e.previousStateParams)},g=function(){var e=u;o.update({id:u.recipe._id},{method:"add"},function(t){c.updateFavoriteRecipes(t.favoriteRecipes),e.recipe.fav_recipe=!0})},v=function(){var e=u;o.update({id:u.recipe._id},{method:"delete"},function(t){c.updateFavoriteRecipes(t.favoriteRecipes),e.recipe.fav_recipe=!1})};return{data:u,setRecipe:d,setFavorite:g,unsetFavorite:v,create:p,update:m,remove:f,cancel:h}}]).factory("RecipeListService",["$rootScope","$stateParams","$uibModal","AlertService","Recipes","$state","Favorites","UserService","Tags",function(e,t,i,r,s,a,n,o,c){var l={recipes:[]},u=function(e,t){var i;for(i=0;i<e.length;i++)if(angular.equals(e[i],t))return i;return!1},d=function(e){l.recipes=e},p=function(){var e=l,i=new Date;i=t.new_recipe?i.setDate(i.getDate()-14):new Date(2015,0,0);var r={author:t.author,updated_at:i,dishType:t.dishType,_id:t.fav_recipe};s.query(r,function(t){e.recipes=t})},m=function(e){var t=l,i=u(l.recipes,e);n.update({id:e._id},{method:"add"},function(e){o.updateFavoriteRecipes(e.favoriteRecipes),t.recipes[i].fav_recipe=!0})},f=function(e){var t=l,i=u(l.recipes,e);n.update({id:e._id},{method:"delete"},function(e){o.updateFavoriteRecipes(e.favoriteRecipes),t.recipes[i].fav_recipe=!1})};return{getObject:function(){return l},setRecipes:d,queryRecipes:p,setFavorite:m,unsetFavorite:f}}]).controller("RecipeDishTypeController",["$scope","UserService","recipeCount",function(e,t,i){e.user=t.getCurrentLoginUser(),e.recipeCount=i.data}]).controller("RecipeListController",["$scope","$stateParams","$uibModal","RecipeListService","tags","user","Favorites","UserService",function(e,t,r,s,a,n,o,c){e.user=n,e.data=s.getObject(),e.tags=a,e.search={},e.tagfilter={},e.hideAdvSearch=!0,e.disableAndClearAuthor=function(){void 0!==e.search.author._id&&(e.search.author.fullname=void 0)},e.filterByTags=function(t){var r=!0;return angular.forEach(e.tagfilter,function(e,s){if(e===!0){var a=!1;for(i=0;i<t.tags.length;i++)if(s===t.tags[i].text){a=!0;break}r=r&&a}}),r},e.switchFavorite=function(e){e.fav_recipe?s.unsetFavorite(e):s.setFavorite(e)},e.share=function(e){r.open({animation:!0,templateUrl:"partials/recipes.share.tpl.html",controller:"ModalShareControllerRecipes",size:"xs",resolve:{recipe:function(){return e}}})}}]).controller("RecipeDetailCtrl",["$rootScope","$scope","$stateParams","$uibModal","Tags","units","dishtypes","TAIngredients","TATags","isCordova","RecipeService","navigationTitle",function(e,t,i,r,s,a,n,o,c,l,u,d){t.isCordova=l,u.data.submitted=!1,t.submitted=u.data.submitted,t.recipe=u.data.recipe,t.factorAvailable=u.data.factorAvailable,t.factor=u.data.factor,t.allowEdit=u.data.allowEdit,t.userExists=u.data.userExists;var p=d.getObject();p.title=t.recipe.name,t.favorite=function(){u.setFavorite()},t.unfavorite=function(){u.unsetFavorite()},t.save=function(){u.create()},t.update=function(){u.update()},t.remove=function(){u.remove()},t.cancel=function(){u.cancel()},t.$on("submittedValueChanged",function(){t.submitted=u.data.submitted}),t.clearImage=function(){t.recipe.imagePath="no_image.png"},t.share=function(){r.open({animation:!0,templateUrl:"partials/recipes.share.tpl.html",controller:"ModalShareControllerRecipes",size:"xs",resolve:{recipe:function(){return t.recipe}}})},t.units=a,t.dishtypes=n,t.onTypeaheadSelect=function(e,i,r){t.recipe.ingredients.filter(function(e){return""==e.ingredient}).length||t.recipe.ingredients.push({qty:"",unit:"",ingredient:""})},t.GetIngredients=function(e){return o.search({search:e,language:t.recipe.language}).$promise.then(function(e){return e})},t.addTag=function(e){if(!e._id){var i=new s(e);i.$save(function(e){var i=t.recipe.tags.length;t.recipe.tags[i-1]=e})}},t.loadTags=function(e){return c.search({search:e}).$promise.then(function(e){return e})},t.$watch("recipeForm.$valid",function(e){u.data.validForm=e})}]).controller("ModalShareControllerRecipes",["$scope","$modalInstance","$filter","recipe",function(e,t,r,s){e.recipe=s;var a=[];for(i=0;i<s.tags.length;i++)a.push(s.tags[i].text);e.hashtags=a.join(", "),e.cancel=function(){t.dismiss("cancel")}}]).controller("RecipeDetailActionsCtrl",["$rootScope","$scope","$uibModal","RecipeService",function(e,t,i,r){t.submitted=r.data.submitted,t.recipe=r.data.recipe,t.allowEdit=r.data.allowEdit,t.userExists=r.data.userExists,t.favorite=function(){r.setFavorite()},t.unfavorite=function(){r.unsetFavorite()},t.save=function(){r.create()},t.update=function(){r.update()},t.remove=function(){r.remove()},t.cancel=function(){r.cancel()},t.share=function(){i.open({animation:!0,templateUrl:"partials/recipes.share.tpl.html",controller:"ModalShareControllerRecipes",size:"xs",resolve:{recipe:function(){return t.recipe}}})}}]).controller("RecipeDetailActionSidebarController",["$rootScope","$scope","$uibModal","RecipeService","$modalInstance",function(e,t,i,r,s){t.submitted=r.data.submitted,t.recipe=r.data.recipe,t.allowEdit=r.data.allowEdit,t.userExists=r.data.userExists,t.favorite=function(){r.setFavorite()},t.unfavorite=function(){r.unsetFavorite()},t.save=function(){r.data.submitted=!0,r.create()},t.update=function(){r.data.submitted=!0,r.update()},t.remove=function(){r.remove()},t.cancel=function(){r.cancel()},t.share=function(){i.open({animation:!0,templateUrl:"partials/recipes.share.tpl.html",controller:"ModalShareControllerRecipes",size:"xs",resolve:{recipe:function(){return t.recipe}}})},t.closeSidebar=function(){s.dismiss("cancel")}}]).controller("ActionSidebarRecipeController",["$scope","$aside",function(e,t){e.recipeDetailsView=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.view.links.tpl.html\'"></div>',controller:"RecipeDetailActionSidebarController",placement:"right",size:"sm"})},e.recipeDetailsEdit=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.edit.links.tpl.html\'"></div>',controller:"RecipeDetailActionSidebarController",placement:"right",size:"sm"})},e.recipeDetailsAdd=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/recipes.add.links.tpl.html\'"></div>',controller:"RecipeDetailActionSidebarController",placement:"right",size:"sm"})}}]).config(["$stateProvider","modalStateProvider","$urlRouterProvider",function(e,t,i){function r(e,t,i){return{url:t,params:i,views:{"main@user":{templateUrl:"partials/recipes.list.tpl.html",controller:"RecipeListController"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.recipes.details.add"><i class="glyphicon glyphicon-plus"></i></button>',controller:"ActionSidebarRecipeController"}},resolve:{recipes:["Recipes","$stateParams","RecipeListService",function(e,t,i){var r=new Date;r=t.new_recipe?r.setDate(r.getDate()-14):new Date(2015,0,0);var s={author:t.author,updated_at:r,dishType:t.dishType,_id:t.fav_recipe};return e.query(s,function(e){i.setRecipes(e)}).$promise}],user:["UserService",function(e){return e.getCurrentLoginUser()}],tags:["Tags",function(e){return e.query().$promise}]},data:{title:e}}}function s(){return{"abstract":!0,url:"/details/:id",views:{"main@user":{templateUrl:"partials/recipes.details.layout.tpl.html"}},resolve:{recipe:["Recipes","$stateParams","RecipeService",function(e,t,i){var r=e.get({id:t.id},function(e){i.setRecipe(e)}).$promise;return r}],units:["Units",function(e){return e.query().$promise}],dishtypes:["DishTypes",function(e){return e.query().$promise}]}}}function a(){return{url:"",params:{factor:null},views:{main:{templateUrl:"partials/recipes.view.tpl.html",controller:"RecipeDetailCtrl"},sidelinks:{templateUrl:"partials/recipes.view.links.tpl.html",controller:"RecipeDetailActionsCtrl"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="recipeDetailsView()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:"ActionSidebarRecipeController"},"actionnavigation-sm@":{template:'<a ng-click="recipeDetailsView()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus" style="padding-right: 10px;"></span>More</a>',controller:"ActionSidebarRecipeController"}}}}function n(e){var t={url:"/edit",views:{}};return t.views["main"+e]={templateUrl:"partials/recipes.edit.form.tpl.html",controller:"RecipeDetailCtrl"},t.views["sidelinks"+e]={templateUrl:"partials/recipes.edit.links.tpl.html",controller:"RecipeDetailActionsCtrl"},t.views["actionnavigation-xs@"]={template:'<button type="button" class="navbar-toggle actionbutton" ng-click="update()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:"RecipeDetailActionsCtrl"},t.views["actionnavigation-sm@"]={template:'<a ng-click="update()" class="navbar-sm-more"><span class="glyphicon glyphicon-floppy-disk" style="padding-right: 10px;"></span>Save</a>',controller:"RecipeDetailActionsCtrl"},t}function o(){return{url:"/scheduleadd",templateUrl:"partials/recipes.scheduleadd.tpl.html",controller:"ModalScheduleAddController",params:{date:void 0,recipe:void 0},resolve:{randomRecipes:["RandomRecipe",function(e){var t=e.query({number:"3"},function(e){return e});return t}]}}}e.state("user.recipes",{url:"/recipes",views:{main:{templateUrl:"partials/recipes.dishtypes.tpl.html",controller:"RecipeDishTypeController"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ui-sref="user.recipes.details.add"><i class="glyphicon glyphicon-plus"></i></button>',controller:"ActionSidebarRecipeController"}},resolve:{recipeCount:["$http","BASE_URI",function(e,t){return e.get(t+"api/recipes/count").success(function(e){return e})}]},data:{title:"Recipes"}}).state("user.recipes.breakfast",r("Breakfast","/breakfast",{dishType:"56294bad07ee48b60ec4405b",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.breakfast.details",s()).state("user.recipes.breakfast.details.view",a()).state("user.recipes.breakfast.details.view.edit",n("@user.recipes.breakfast.details")).state("user.recipes.appetizer",r("Appetizer","/appetizer",{
dishType:"562934ae137c052908b75e23",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.appetizer.details",s()).state("user.recipes.appetizer.details.view",a()).state("user.recipes.appetizer.details.view.edit",n("@user.recipes.appetizer.details")).state("user.recipes.drinks",r("Drinks","/drinks",{dishType:"562940bd4bdc01930dca94d8",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.drinks.details",s()).state("user.recipes.drinks.details.view",a()).state("user.recipes.drinks.details.view.edit",n("@user.recipes.drinks.details")).state("user.recipes.salads",r("Salads","/salads",{dishType:"562940db4bdc01930dca94da",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.salads.details",s()).state("user.recipes.salads.details.view",a()).state("user.recipes.salads.details.view.edit",n("@user.recipes.salads.details")).state("user.recipes.maindishes",r("Main Dishes","/maindishes",{dishType:"56293446137c052908b75e22",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.maindishes.details",s()).state("user.recipes.maindishes.details.view",a()).state("user.recipes.maindishes.details.view.edit",n("@user.recipes.maindishes.details")).state("user.recipes.sidedishes",r("Side Dishes","/sidedishes",{dishType:"562940cc4bdc01930dca94d9",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.sidedishes.details",s()).state("user.recipes.sidedishes.details.view",a()).state("user.recipes.sidedishes.details.view.edit",n("@user.recipes.sidedishes.details")).state("user.recipes.desserts",r("Desserts","/desserts",{dishType:"562940ee4bdc01930dca94db",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.desserts.details",s()).state("user.recipes.desserts.details.view",a()).state("user.recipes.desserts.details.view.edit",n("@user.recipes.desserts.details")).state("user.recipes.breads",r("Breads","/breads",{dishType:"562aabc37a696f1229593c42",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.breads.details",s()).state("user.recipes.breads.details.view",a()).state("user.recipes.breads.details.view.edit",n("@user.recipes.breads.details")).state("user.recipes.eveningsnacks",r("Evening Snacks","/eveningsnacks",{dishType:"5668a3b36faed8e960d4f213",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.eveningsnacks.details",s()).state("user.recipes.eveningsnacks.details.view",a()).state("user.recipes.eveningsnacks.details.view.edit",n("@user.recipes.eveningsnacks.details")).state("user.recipes.other",r("Other Recipes","/other",{dishType:"5629f52a2b9118f35b96c2ca",author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.other.details",s()).state("user.recipes.other.details.view",a()).state("user.recipes.other.details.view.edit",n("@user.recipes.other.details")).state("user.recipes.all",r("All Recipes","/all",{dishType:void 0,author:void 0,new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.all.details",s()).state("user.recipes.all.details.view",a()).state("user.recipes.all.details.view.edit",n("@user.recipes.all.details")).state("user.recipes.my",r("My Recipes","/my",{dishType:void 0,author:"self",new_recipe:void 0,fav_recipe:void 0})).state("user.recipes.my.details",s()).state("user.recipes.my.details.view",a()).state("user.recipes.my.details.view.edit",n("@user.recipes.my.details")).state("user.recipes.new",r("New Recipes","/new",{dishType:void 0,author:void 0,new_recipe:!0,fav_recipe:void 0})).state("user.recipes.new.details",s()).state("user.recipes.new.details.view",a()).state("user.recipes.new.details.view.edit",n("@user.recipes.new.details")).state("user.recipes.favorites",r("Favorite Recipes","/favorites",{dishType:void 0,author:void 0,new_recipe:void 0,fav_recipe:!0})).state("user.recipes.favorites.details",s()).state("user.recipes.favorites.details.view",a()).state("user.recipes.favorites.details.view.edit",n("@user.recipes.favorites.details")).state("user.recipes.details",{"abstract":!0,url:"/details/:id",params:{factor:null},views:{"main@user":{templateUrl:"partials/recipes.details.layout.tpl.html"}},resolve:{recipe:["Recipes","$stateParams","RecipeService",function(e,t,i){if(t.id){var r=e.get({id:t.id},function(e){e.ingredients.push({qty:"",unit:"",ingredient:""}),i.setRecipe(e,t.factor)}).$promise;return r}var r=new e;return r.ingredients=[],r.ingredients.push({qty:"",unit:"",ingredient:""}),r.imagePath="no_image.png",i.data.recipe=r,r}],units:["Units",function(e){return e.query().$promise}],dishtypes:["DishTypes",function(e){return e.query().$promise}]}}).state("user.recipes.details.view",a()).state("user.recipes.details.edit",n()).state("user.recipes.details.add",{url:"^/recipe/add",views:{main:{templateUrl:"partials/recipes.edit.form.tpl.html",controller:"RecipeDetailCtrl"},sidelinks:{templateUrl:"partials/recipes.add.links.tpl.html",controller:"RecipeDetailActionsCtrl"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="save()"><i class="glyphicon glyphicon-floppy-disk"></i></button>',controller:"RecipeDetailActionsCtrl"},"actionnavigation-sm@":{template:'<a ng-click="save()" class="navbar-sm-more"><span class="glyphicon glyphicon-floppy-disk" style="padding-right: 10px;"></span>Save</a>',controller:"RecipeDetailActionsCtrl"}}}).state("anon.recipes",{"abstract":!0,url:"/sharedrecipe",template:"<ui-view />",data:{title:"Recipes"}}).state("anon.recipes.details",{"abstract":!0,url:"/:id",params:{factor:null},templateUrl:"partials/recipes.details.layout.tpl.html",resolve:{recipe:["Recipes","$stateParams","RecipeService",function(e,t,i){if(t.id){var r=e.get({id:t.id},function(e){e.ingredients.push({qty:"",unit:"",ingredient:""}),i.setRecipe(e,t.factor)}).$promise;return r}var r=new e;return r.ingredients=[],r.ingredients.push({qty:"",unit:"",ingredient:""}),r.imagePath="no_image.png",i.data.recipe=r,r}],units:function(){return{}},dishtypes:function(){return{}}}}).state("anon.recipes.details.view",{url:"",params:{factor:null},views:{main:{templateUrl:"partials/recipes.view.tpl.html",controller:"RecipeDetailCtrl"},sidelinks:{templateUrl:"partials/recipes.view.links.tpl.html",controller:"RecipeDetailActionsCtrl"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle actionbutton" ng-click="recipeDetailsView()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:"ActionSidebarRecipeController"},"actionnavigation-sm@":{template:'<a ng-click="recipeDetailsView()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus" style="padding-right: 10px;"></span>More</a>',controller:"ActionSidebarRecipeController"}}}).state("anon.recipes.details.view.edit",n("@anon.recipes.details")),t.state("user.recipes.breakfast.details.view.scheduleadd",o()).state("user.recipes.appetizer.details.view.scheduleadd",o()).state("user.recipes.drinks.details.view.scheduleadd",o()).state("user.recipes.salads.details.view.scheduleadd",o()).state("user.recipes.maindisches.details.view.scheduleadd",o()).state("user.recipes.sidedisches.details.view.scheduleadd",o()).state("user.recipes.desserts.details.view.scheduleadd",o()).state("user.recipes.breads.details.view.scheduleadd",o()).state("user.recipes.eveningsnacks.details.view.scheduleadd",o()).state("user.recipes.other.details.view.scheduleadd",o()).state("user.recipes.all.details.view.scheduleadd",o()).state("user.recipes.my.details.view.scheduleadd",o()).state("user.recipes.new.details.view.scheduleadd",o()).state("user.recipes.favorites.details.view.scheduleadd",o()).state("anon.recipes.details.view.scheduleadd",o()).state("user.recipes.breakfast.scheduleadd",o()).state("user.recipes.appetizer.scheduleadd",o()).state("user.recipes.drinks.scheduleadd",o()).state("user.recipes.salads.scheduleadd",o()).state("user.recipes.maindisches.scheduleadd",o()).state("user.recipes.sidedisches.scheduleadd",o()).state("user.recipes.desserts.scheduleadd",o()).state("user.recipes.breads.scheduleadd",o()).state("user.recipes.eveningsnacks.scheduleadd",o()).state("user.recipes.other.scheduleadd",o()).state("user.recipes.all.scheduleadd",o()).state("user.recipes.my.scheduleadd",o()).state("user.recipes.new.scheduleadd",o()).state("user.recipes.favorites.scheduleadd",o())}]),angular.module("app.schedules",["ui.router","modalstate"]).factory("Schedules",["$resource","BASE_URI",function(e,t){return e(t+"api/schedules/:id",null,{update:{method:"PUT"}})}]).factory("RandomRecipe",["$resource","BASE_URI",function(e,t){return e(t+"api/randomitems/recipes/:number",null,{update:{method:"PUT"}})}]).factory("SchedulesService",["UserService","AlertService","Schedules","$q","$rootScope",function(e,t,r,s,a){var n={schedules:[],selectedDates:[],activeDate:!1},o=function(e){e||(e=new Date),e.setHours(0,0,0,0),n.activeDate=e},c=function(e,t){e||(n.activeDate||o(),e=n.activeDate),t||(t=7);var r=[];for(i=0;i<t;i++){var s=new Date(e.getTime());s.setDate(s.getDate()+i),s.setHours(0,0,0,0),r.push(s.getTime())}n.selectedDates=r,a.$broadcast("selectedDatesUpdated")},l=function(t){var i=new Date,r=i.getDay(),s=e.data.currentUser.settings.preferredWeekStartDay?e.data.currentUser.settings.preferredWeekStartDay:0;s>r?i.setDate(i.getDate()-i.getDay()+s-7+7*t):i.setDate(i.getDate()-i.getDay()+s+7*t),c(i,7),d()},u=function(){var e=s.defer(),t=Math.min.apply(null,n.selectedDates),a=Math.max.apply(null,n.selectedDates),o=new Date(t);o.setHours(0,0,0,0),o=o.getTime();var c=new Date(a);return c.setDate(c.getDate()+1),c.setHours(0,0,0,0),c=c.getTime(),r.query({startDate:o,endDate:c},function(t){var r=[];for(i=0;i<n.selectedDates.length;i++){var s=new Date(n.selectedDates[i]);s.setHours(0,0,0,0),r[i]={date:s,schedule:[]}}for(i=0;i<t.length;i++){var s=new Date(t[i].date);for(s.setHours(0,0,0,0),j=0;j<n.selectedDates.length;j++)angular.equals(r[j].date,s)&&r[j].schedule.push(t[i])}e.resolve(r)}),e.promise},d=function(){u().then(function(e){n.schedules=e,a.$broadcast("schedulesUpdated")})},p=function(e,i){r.remove({id:e._id},function(){var r=n.schedules[i].schedule.indexOf(e);n.schedules[i].schedule.splice(r,1),a.$broadcast("schedulesUpdated");var s="The recipe "+e.recipe.name+" was successfully removed from schedule";t.add("info",s)})};return o(),{data:n,setActiveDate:o,selectPeriod:c,selectWeek:l,update:d,retrieve:u,remove:p}}]).controller("SchedulesController",["$scope","$stateParams","$uibModal","Schedules","schedules","SchedulesService","RandomRecipe",function(e,t,i,r,s,a,n){e.selectedDates=a.data.selectedDates,e.$on("selectedDatesUpdated",function(){e.selectedDates=a.data.selectedDates}),e.schedulesArray=a.data.schedules,e.$on("schedulesUpdated",function(){e.schedulesArray=a.data.schedules}),e.activeDate=a.data.activeDate,a.setActiveDate(),e.selectSevenDays=function(e){a.selectPeriod(e,7)},e.selectSevenDays(e.activeDate),e.updateSchedules=function(){a.update()},e.selectWeek=function(e){a.selectWeek(e)},e.remove=function(e,t){a.remove(e,t)},e.scheduleEdit=function(e){i.open({animation:!0,templateUrl:"partials/schedules.edit.tpl.html",controller:"ModalScheduleEditController",size:"xs",resolve:{schedule:function(){return e}}})}}]).controller("ModalScheduleEditController",["$scope","$stateParams","$uibModalInstance","$filter","AlertService","SchedulesService","Schedules","schedule",function(e,t,i,r,s,a,n,o){e.recipe=o.recipe,e.date=o.date,e.factor=o.factor,e.remove=function(){n.remove({id:o._id},function(){var e="The recipe "+o.recipe.name+" was successfully removed from schedule";s.add("info",e),a.update(),i.close()})},e.ok=function(){o.date=e.date,o.factor=e.factor,n.update({id:o._id},o,function(t){var n="The recipe "+e.recipe.name+" was successfully scheduled for the "+r("date")(e.date,"dd.MM.yyyy")+" with "+e.factor+" persons.";s.add("success",n),a.update(),i.close()})},e.cancel=function(){i.dismiss("cancel")}}]).controller("ModalScheduleAddController",["$scope","$state","$stateParams","$uibModalInstance","$filter","AlertService","SchedulesService","Schedules","randomRecipes","TARecipes",function(e,t,i,r,s,a,n,o,c,l){e.date=i.date?i.date:new Date,e.newrecipe=i.recipe?i.recipe:void 0,e.factor=i.recipe&&i.recipe["yield"]?i.recipe["yield"]:void 0,e.randomRecipes=c,e.GetRecipes=function(e){return l.search({search:e}).$promise.then(function(e){return e})},e.TASelect=function(t){e.factor=t["yield"]},e.selectRecipe=function(t){e.factor||(e.factor=t["yield"]),e.newrecipe=t},e.ok=function(){if(e.newrecipe&&!(e.newrecipe.length<1)){(!e.factor||e.factor.length<1)&&(e.factor=e.recipe["yield"]);var i=new o({date:e.date.setHours(12),recipe:e.newrecipe,factor:e.factor});i.$save(function(i){var o="The recipe "+e.newrecipe.name+" was successfully scheduled for the "+s("date")(e.date,"dd.MM.yyyy")+" with "+e.factor+" persons.";a.add("success",o),t.includes("user.schedules")&&n.update(),r.close()})}},e.cancel=function(){r.dismiss("cancel")}}]).config(["$stateProvider","modalStateProvider","$urlRouterProvider",function(e,t,i){e.state("user.schedules",{url:"/schedules",views:{main:{templateUrl:"partials/schedules.tpl.html",controller:"SchedulesController"}},resolve:{schedules:["SchedulesService",function(e){return e.selectPeriod(),e.update()}]},data:{title:"Schedules"}}),t.state("user.schedules.add",{url:"/add",templateUrl:"partials/schedules.add.tpl.html",controller:"ModalScheduleAddController",params:{date:void 0,recipe:void 0},resolve:{randomRecipes:["RandomRecipe",function(e){var t=e.query({number:"3"},function(e){return e});return t}]}})}]),angular.module("app.alert",[]).factory("AlertService",function(){function e(e,i){return n.push({type:e,msg:i,close:function(){return t(this)}})}function t(e){return i(n.indexOf(e))}function i(e){return n.splice(e,1)}function r(){n=[]}function s(){return n}var a={add:e,closeAlert:t,closeAlertIdx:i,clear:r,get:s},n=[];return a}).controller("AlertController",["$scope","AlertService",function(e,t){e.alerts=t.get()}]),angular.module("app.shopitems",["ui.router","modalstate"]).factory("Shopitems",["$resource","BASE_URI",function(e,t){return e(t+"api/shopitems/:id",null,{update:{method:"PUT"}})}]).factory("Frequentshopitems",["$resource","BASE_URI",function(e,t){return e(t+"api/frequentshopitems/")}]).factory("ShopitemService",["$rootScope","$timeout","$q","UserService","Shopitems",function(e,t,r,s,a){var n,o={shopitems:[],alerts:[],autoupdate:!0,pauseAutoupdate:0},c=function(e,t){var i;for(i=0;i<e.length;i++)if(angular.equals(e[i],t))return i;return!1},l=function(){var t=r.defer();return a.query(function(r){var a=[],n=[],l=s.getCurrentLoginUser();for(i=0;i<r.length;i++){if(r[i].ingredient)var u=l.settings.categoryOrder.indexOf(r[i].ingredient.category)>=0?l.settings.categoryOrder.indexOf(r[i].ingredient.category):99999;else var u=99999;if(r[i].ingredient&&r[i].unit&&r[i].amount){r[i].ingredient.name_translated=r[i].ingredient.name[l.settings.preferredLanguage],r[i].unit.name_translated=r[i].unit.name[l.settings.preferredLanguage];var d={ingredient:r[i].ingredient,unit:r[i].unit,order:u,completed:r[i].completed,details:[],amount:0},p=c(n,d);p===!1?(n.push({ingredient:r[i].ingredient,unit:r[i].unit,order:u,completed:r[i].completed,details:[],amount:0}),d.details.push(r[i]),d.amount=r[i].amount,a.push(d)):(a[p].details.push(r[i]),a[p].amount=r[i].amount+a[p].amount)}}t.resolve(a),o.shopitems=a,e.$broadcast("shopitemsUpdated")}),t.promise},u=function(e){var t=new Date;t.setDate(t.getDate()+14),t.setHours(0,0,0,0);var i=new a({ingredient:e.ingredient,unit:e.unit,amount:e.amount,completed:!1,expire_date:t});i.$save(),o.shopitems.push({ingredient:e.ingredient,unit:e.unit,completed:e.completed,details:[e],amount:e.amount})},d=function(i){if(o.pauseAutoupdate=o.pauseAutoupdate+1,i){var r=c(o.shopitems,i);if(r===!1)o.alerts.push({type:"danger",msg:"Match not found in existing shopping list, please inform the developer."});else for(var s=i.details.length-1;s>=0;s--)a.remove({id:i.details[s]._id},null,function(e){for(var t,i=0;i<o.shopitems[r].details.length;i++)o.shopitems[r].details[i]._id==e._id&&(t=i);o.shopitems[r].details.splice(t,1),0===o.shopitems[r].details.length&&o.shopitems.splice(r,1)},function(e){o.alerts.push({type:"danger",msg:"Network connection error"})})}else a.remove({},null,function(t){o.shopitems=[],e.$broadcast("shopitemsUpdated")},function(e){o.alerts.push({type:"danger",msg:"Network connection error"})});t(function(){o.pauseAutoupdate=o.pauseAutoupdate-1},5e3)},p=function(e){o.pauseAutoupdate=o.pauseAutoupdate+1;var i=c(o.shopitems,e);if(i===!1)o.alerts.push({type:"danger",msg:"Match not found in existing shopping list, please inform the developer."});else{e.completed=!e.completed;for(var r=e.details.length-1;r>=0;r--)a.update({id:e.details[r]._id},{completed:e.completed},function(t){for(var r,s=0;s<o.shopitems[i].details.length;s++)o.shopitems[i].details[s]._id==t._id&&(r=s);o.shopitems[i].details[r].completed=e.completed},function(e){o.alerts.push({type:"danger",msg:"Network connection error"})});o.shopitems[i].completed=e.completed}t(function(){o.pauseAutoupdate=o.pauseAutoupdate-1},5e3)},m=function(){o.autoupdate===!0&&o.pauseAutoupdate<=0?(l(),this.timer=t(function(){m()},5e3)):o.autoupdate===!1?t.cancel(n):this.timer=t(function(){m()},5e3)},f=function(){o.autoupdate!==!1&&this.timer||(o.autoupdate=!0,e.$broadcast("autoupdateValueChanged"),m())},h=function(){o.autoupdate=!1,e.$broadcast("autoupdateValueChanged"),t.cancel(n)};return{data:o,retrieveShopitems:l,addShopitem:u,remove:d,complete:p,startAutoupdate:f,stopAutoupdate:h}}]).controller("ShopitemsController",["$scope","$uibModal","ShopitemService","Shopitems","frequentshopitems","TAIngredients","units","shopitems",function(e,t,r,s,a,n,o,c){for(e.units=o,e.frequentshopitems=a,e.shopitems=r.data.shopitems,e.autoupdate=r.data.autoupdate,e.alerts=r.data.alerts,e.$on("shopitemsUpdated",function(){e.shopitems=r.data.shopitems}),e.$on("autoupdateValueChanged",function(){e.autoupdate=r.data.autoupdate}),e.status=[],i=0;i<e.shopitems.length;i++)e.status[e.shopitems[i].ingredient.category]=!0;e.addShopitem=function(e){r.addShopitem(e)},e.remove=function(e){r.remove(e)},e.complete=function(e){r.complete(e)},e.startAutoupdate=function(){r.startAutoupdate()},e.stopAutoupdate=function(){r.stopAutoupdate()},e.autoupdate===!0&&e.startAutoupdate(),e.$on("$destroy",function(t){e.stopAutoupdate()}),e.GetIngredients=function(e){return n.search({search:e,language:"de"}).$promise.then(function(e){return e})},e.shopitemDetails=function(i){var s=t.open({animation:!0,templateUrl:"partials/shopitems.modal.details.tpl.html",controller:"ModalShopitemDetailsController",size:"lg",resolve:{item:function(){return i},units:function(){return e.units}}});s.result.then(function(){r.retrieveShopitems()})},e.closeAlert=function(t){e.alerts.splice(t,1)}}]).controller("ShopitemsActionController",["$scope","$uibModal","ShopitemService","units",function(e,t,i,r){e.units=r,e.autoupdate=i.data.autoupdate,e.alerts=i.data.alerts,e.$on("autoupdateValueChanged",function(){e.autoupdate=i.data.autoupdate}),e.addShopitem=function(e){i.addShopitem(e)},e.remove=function(e){i.remove(e)},e.startAutoupdate=function(){i.startAutoupdate()},e.stopAutoupdate=function(){i.stopAutoupdate()}}]).controller("ShopitemsActionSidebarController",["$scope","$uibModal","ShopitemService","units","$uibModalInstance",function(e,t,i,r,s){e.units=r,e.autoupdate=i.data.autoupdate,e.alerts=i.data.alerts,e.$on("autoupdateValueChanged",function(){e.autoupdate=i.data.autoupdate}),e.addShopitem=function(e){i.addShopitem(e)},e.remove=function(e){i.remove(e)},e.startAutoupdate=function(){i.startAutoupdate()},e.stopAutoupdate=function(){i.stopAutoupdate()},e.closeSidebar=function(){s.dismiss("cancel")}}]).controller("ModalShopitemDetailsController",["$scope","$stateParams","$uibModalInstance","item","Shopitems",function(e,t,i,r,s){e.item=r,e.complete=function(t){t.completed=!t.completed,s.update({id:t._id},{completed:t.completed},function(i){for(var r=0;r<e.item.details.length;r++)e.item.details[r]._id==i._id&&(e.item.details[r].completed=t.completed)},function(e){})},e.remove=function(t){t.completed=!t.completed,s.remove({id:t._id},null,function(t){for(var i=0;i<e.item.details.length;i++)e.item.details[i]._id==t._id&&e.item.details.splice(i,1)},function(e){})},e.close=function(){i.close()}}]).controller("ModalShopitemAddController",["$scope","$stateParams","$uibModalInstance","TAIngredients","units","ShopitemService",function(e,t,r,s,a,n){e.submitted=!1,e.units=a,e.newunit=t.unit?t.unit._id:void 0,e.newingredient=t.ingredient?t.ingredient:void 0,e.GetIngredients=function(e){return s.search({search:e,language:"de"}).$promise.then(function(e){return e})},e.ok=function(t){if(!t)return void(e.submitted=!0);for(i=0;i<e.units.length;i++)e.units[i]._id===e.newunit&&(e.newunitobject=e.units[i]);var s={amount:e.newamount,unit:e.newunitobject,ingredient:e.newingredient};n.addShopitem(s),r.close()},e.cancel=function(){r.dismiss("cancel")}}]).controller("ActionSidebarShopitemsController",["$scope","$aside","units",function(e,t,i){e.shopitemsActions=function(){t.open({template:'<div ng-click="closeSidebar()" ng-include="\'partials/shopitems.links.tpl.html\'"></div>',controller:"ShopitemsActionSidebarController",placement:"right",size:"sm",resolve:{units:function(){return i}}})}}]).config(["$stateProvider","modalStateProvider","$urlRouterProvider",function(e,t,i){e.state("user.shopitems",{"abstract":!0,url:"/shopitems",views:{main:{templateUrl:"partials/shopitems.layout.tpl.html"}},resolve:{shopitems:["ShopitemService",function(e){return e.data.autoupdate=!0,e.retrieveShopitems().then(function(e){return e})}],frequentshopitems:["Frequentshopitems",function(e){return e.query().$promise}],units:["Units",function(e){return e.query().$promise}]},data:{title:"Shopping"}}).state("user.shopitems.view",{url:"",views:{main:{templateUrl:"partials/shopitems.tpl.html",controller:"ShopitemsController"},sidelinks:{templateUrl:"partials/shopitems.links.tpl.html",controller:"ShopitemsActionController"},"actionnavigation-xs@":{template:'<button type="button" class="navbar-toggle visible-xs actionbutton" ng-click="shopitemsActions()"><i class="glyphicon glyphicon-option-horizontal"></i></button>',controller:"ActionSidebarShopitemsController"},"actionnavigation-sm@":{template:'<a ng-click="shopitemsActions()" class="navbar-sm-more"><span class="glyphicon glyphicon-plus" style="padding-right: 10px;"></span>More</a>',controller:"ActionSidebarShopitemsController"}}}),t.state("user.shopitems.view.add",{url:"/add",templateUrl:"partials/shopitems.modal.add.tpl.html",controller:"ModalShopitemAddController",params:{ingredient:void 0,unit:void 0},resolve:{units:["Units",function(e){return e.query().$promise}]}})}]),angular.module("app.units",["ui.router"]).factory("Units",["$resource","BASE_URI",function(e,t){return e(t+"api/units/:id",null,{update:{method:"PUT"}})}]).controller("UnitsController",["$scope","units",function(e,t){e.units=t}]).controller("UnitDetailCtrl",["$scope","$stateParams","unit","Units","$state",function(e,t,i,r,s){e.unit=i,e.update=function(){r.update({id:e.unit._id},e.unit,function(){s.go("admin.units.list")})},e.remove=function(){r.remove({id:e.unit._id},function(){s.go("admin.units.list")})},e.save=function(){if(e.newunit&&!(e.newunit.length<1)){var t=new r({name:{en:e.newunit.name.en,de:e.newunit.name.de,fi:e.newunit.name.fi}});t.$save(function(){s.go("admin.units.list")})}}}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("admin.units",{"abstract":!0,url:"/units",template:"<ui-view />",data:{title:"Units"}}).state("admin.units.list",{url:"/list",templateUrl:"partials/units.tpl.html",controller:"UnitsController",resolve:{units:["Units",function(e){return e.query().$promise}]},data:{name:"Units",icon:"glyphicon glyphicon-scale"}}).state("admin.units.edit",{url:"/edit/:id",templateUrl:"partials/units.details.tpl.html",controller:"UnitDetailCtrl",resolve:{unit:["Units","$stateParams",function(e,t){var i=e.get({id:t.id},function(e){return e}).$promise;return i}]}}).state("admin.units.add",{url:"/add",templateUrl:"partials/units.add.tpl.html",controller:"UnitDetailCtrl",resolve:{unit:["Units",function(e){var t=new e;return t}]}})}]);